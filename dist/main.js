/*! For license information please see main.js.LICENSE.txt */
!function(){var t={642:function(t,e,n){const s=n(364),i=n(41),r=n(839),o=n(212),a=n(602),c=["beaver","cat","dog","fish","frog","lizard","monkey","pig","rabbit","raccoon","rat","snail","squirrel","turtle","snake"],h={rat:"more snacks spawn",fish:"swim through water",turtle:"block damage once",pig:"hold more snacks",cat:"extra life",dog:"bonus points",rabbit:"easier bonuses"};function u(t,e){this.DIM_X=t,this.DIM_Y=e,this.snacks=[],this.obstacles=[],this.lives=5,this.level=0,this.over="no",this.img=new Image,this.img.src="grass.jpg",this.win=new Image,this.win.src="win.png",this.menu=["rat","fish","turtle","pig","cat","dog","rabbit"],this.paused=!0,this.message="SSPACE TO SSTART",this.topLogs=[],this.bottomLogs=[],this.maxSnacks=3,this.winLength=200,this.score=0,this.winMusic=new Audio("win.mp3"),this.snake=new s(this),this.startLevel()}u.prototype.randomPos=function(t){return[Math.random()*this.DIM_X,Math.random()*this.DIM_Y]},u.prototype.allObjects=function(){return this.obstacles.concat([this.snake]).concat(this.snacks)},u.prototype.startLevel=function(){for(this.snacks=[],this.obstacles=[],this.topLogs=[],this.bottomLogs=[],this.level++;this.snacks.length<this.maxSnacks;)this.makeSnack();new a(this,this.level),this.levelCleanUp(),this.snake.reset(),this.drawBottomLogs=!1;let t=this;setTimeout((()=>t.drawBottomLogs=!0),1500)},u.prototype.levelCleanUp=function(){const t=this.snake.powers;t.includes("cat")&&this.lives++,t.includes("dog")&&(this.score+=1e3*this.level)},u.prototype.makeSnack=function(){let t=this.menu[Math.floor(this.menu.length*Math.random())],e=new i([0,0],t);for(;r.outOfBounds(e.pos,this,e.radius);)e.pos=this.randomPos(e.rad);this.snacks.push(e)},u.prototype.makeObstacle=function(t,e){"log"!=e?this.obstacles.push(new o(t,e)):t[1]<this.DIM_Y/2?this.topLogs.push(new o(t,e)):this.bottomLogs.push(new o(t,e))},u.prototype.end=function(){let t=prompt("Add your name to the Hall of Fame?","Your Name");this.sendScore([this.score,t])},u.prototype.draw=function(t,e){if("no"===this.over){if(6===this.level)return this.winMusic.play(),this.score+=5e3,this.over="won",t.drawImage(this.win,0,0),void this.end();t.drawImage(this.img,0,0),this.allObjects().forEach((e=>e.draw(t))),this.snake.maxLength<this.winLength&&this.topLogs.forEach((e=>e.draw(t))),this.drawBottomLogs&&this.bottomLogs.forEach((e=>e.draw(t))),this.drawInfo(e)}(this.paused||"died"===this.over)&&(t.textAlign="center",t.fillStyle="white","died"===this.over&&(t.fillStyle="red"),t.font="96px serif",t.fillText(this.message,this.DIM_X/2,this.DIM_Y/2))},u.prototype.drawInfo=function(t){const e=this.setIcons();t.fillStyle="#FEFEE2",t.fillRect(0,0,400,600),t.fillStyle="#80c27d",t.font="24px Caveat Brush",t.fillText(`Level: ${this.level}`,10,30),t.fillText(`Score: ${this.score}`,10,60),t.fillText(`Length: ${this.snake.maxLength} mm / ${this.winLength} mm (for next level)`,10,90),t.fillText("Lives:",10,120);for(let n=0;n<this.lives;n++)t.drawImage(e.snake,70+35*n,100,30,30);t.fillText("Menu:",10,150);for(let n=0;n<this.menu.length&&n<9;n++)t.drawImage(e[this.menu[n]],10+35*n,160,30,30);for(let n=9;n<this.menu.length&&n<16;n++)t.drawImage(e[this.menu[n]],10+35*(n-9),190,30,30);t.fillText("Stomach:",10,240);for(let n=0;n<this.snake.stomach.length&&n<8;n++)t.drawImage(e[this.snake.stomach[n]],10+35*n,250,30,30);for(let n=8;n<this.snake.stomach.length&&n<16;n++)t.drawImage(e[this.snake.stomach[n]],10+35*(n-8),280,30,30);t.fillText("Powers: DLC coming soon!",10,400);for(let n=0;n<this.snake.powers.length;n++)t.drawImage(e[this.snake.powers[n]],10,410+30*n,30,30),t.fillText(h[this.snake.powers[n]],50,430+30*n)},u.prototype.setIcons=function(){let t={};return c.forEach((function(e){t[e]=new Image,t[e].src=`./emojis/${e}.png`})),t},u.prototype.moveObjects=function(){this.snake.move()},u.prototype.step=function(){"no"!==this.over||this.paused||(this.moveObjects(),this.checkCollisions())},u.prototype.checkCollisions=function(){let t=this.snake,e=this;t.nextLevel()?this.startLevel():(t.outOfBounds()&&t.hurt(),t.selfBite()&&t.hurt(!0),this.snacks.forEach((function(n){r.hypotenuse(n.pos,t.pos)<t.headRadius+n.radius&&t.eat(n),(e.snacks.length<e.maxSnacks||e.snake.powers.includes("rat")&&e.snacks.length<e.maxSnacks+2)&&e.makeSnack()})),this.obstacles.forEach((function(e){r.hypotenuse(e.pos,t.pos)<t.headRadius+e.radius/2&&("water"===e.type&&t.powers.includes("fish")||t.hit(e))})))},u.prototype.destroy=function(t){this.snacks.splice(this.snacks.indexOf(t),1)},u.prototype.pause=function(){this.paused||"no"!==this.over?this.paused=!1:(this.paused=!0,this.message="GAME PAUSED")},u.prototype.makeHighScoreTable=async function(){let t=await this.getScore();this.scores=t.slice();let e=this.scores.sort((function(t,e){return e.data[0]-t.data[0]}));const n=document.getElementById("high-scores");for(let t=0;t<10;t++)if(e[t]){const s=document.createElement("tr"),i=document.createElement("td"),r=document.createElement("td"),o=document.createTextNode(e[t].data[1]),a=document.createTextNode(e[t].data[0]);i.appendChild(o),r.appendChild(a),s.appendChild(i),s.appendChild(r),n.appendChild(s)}},t.exports=u},938:function(t,e,n){function s(t,e,n){this.game=t,this.ctx=e,this.info=n,this.snake,this.game.draw.bind(this.game)}n(642),n(364),s.prototype.start=function(){let t=this;setInterval(t.game.draw.bind(t.game,t.ctx,t.info),20),setInterval(t.game.step.bind(t.game),20),this.bindKeyHandlers(),this.game.getScore().then((t=>{this.game.scores=t}))},s.prototype.bindKeyHandlers=function(){this.snake=this.game.snake,key("w",(()=>{this.snake.turn([0,-1])})),key("a",(()=>{this.snake.turn([-1,0])})),key("s",(()=>{this.snake.turn([0,1])})),key("d",(()=>{this.snake.turn([1,0])})),key("up",(()=>{this.snake.turn([0,-1])})),key("left",(()=>{this.snake.turn([-1,0])})),key("down",(()=>{this.snake.turn([0,1])})),key("right",(()=>{this.snake.turn([1,0])})),key("space",(()=>{this.game.pause()})),key("esc",(()=>{alert("<GAME PAUSED>")}))},t.exports=s},602:function(t){t.exports=function(t,e){const n=["fire","ice","log","rock","water","tornado"],s={};n.forEach((t=>s[t]=[]));for(let e=0;e<t.DIM_Y;e+=30)s.rock.push([10,e]),s.rock.push([t.DIM_X-10,e]);for(let e=0;e<t.DIM_X;e+=30)(e<t.DIM_X/2-50||e>t.DIM_X/2+50)&&(s.rock.push([e,10]),s.rock.push([e,t.DIM_Y-10]));for(let e=t.DIM_X/2-45;e<t.DIM_X/2+75;e+=30)s.log.push([e,10]),s.log.push([e,t.DIM_Y-10]);switch(e){case 1:s.water.push([t.DIM_X/2,t.DIM_Y/2]);break;case 2:s.fire.push([t.DIM_X/4,t.DIM_Y/4]),s.water.push([3*t.DIM_X/4,3*t.DIM_Y/4]),s.ice.push([3*t.DIM_X/4,t.DIM_Y/4]),s.tornado.push([t.DIM_X/4,3*t.DIM_Y/4]);break;case 3:for(let e=150;e<=t.DIM_Y-150;e+=25){for(let n=300;n<=t.DIM_X-300;n+=25)s.ice.push([n,e]);s.fire.push([100,e]),s.fire.push([t.DIM_X-100,e]),s.water.push([275,e]),s.water.push([t.DIM_X-275,e])}break;case 4:for(let e=t.DIM_X/2-200;e<=t.DIM_X/2+200;e+=25)s.water.push([e,t.DIM_Y/2]);for(let e=25;e<t.DIM_X/2-200;e+=25)s.tornado.push([e,e]),s.tornado.push([t.DIM_X-e,e]),s.tornado.push([e,t.DIM_Y-e]),s.tornado.push([t.DIM_X-e,t.DIM_Y-e]);break;case 5:for(let e=25;e<450;e+=25)s.fire.push([e,e]),s.fire.push([t.DIM_X-e,t.DIM_Y-e]),s.water.push([t.DIM_X/2,t.DIM_Y/2]),s.water.push([t.DIM_X/4,3*t.DIM_Y/4]),s.water.push([3*t.DIM_X/4,t.DIM_Y/4]),s.water.push([.5*t.DIM_X/4,3*t.DIM_Y/4]),s.water.push([3.5*t.DIM_X/4,t.DIM_Y/4])}n.forEach((function(e){for(let n=0;n<s[e].length;n++)t.makeObstacle(s[e][n],e)}))}},212:function(t){function e(t,e){this.pos=t,this.type=e,this.radius=20,this.img=new Image,this.img.src=`./obstacles/${e}.png`}e.prototype.draw=function(t){t.drawImage(this.img,this.pos[0]-this.radius,this.pos[1]-this.radius,2*this.radius,2*this.radius)},e.prototype.move=function(){},t.exports=e},41:function(t){function e(t,e){this.pos=t,this.type=e,this.color="red",this.radius=30,this.img=new Image,this.img.src=`./emojis/${e}.png`}e.prototype.draw=function(t){t.drawImage(this.img,this.pos[0]-this.radius,this.pos[1]-this.radius,2*this.radius,2*this.radius)},e.prototype.move=function(){},t.exports=e},364:function(t,e,n){const s=n(839),i=["beaver","cat","dog","fish","frog","lizard","monkey","pig","rabbit","raccoon","rat","snail","squirrel","turtle","snake"],r=["cat","dog","squirrel","raccoon"];function o(t){this.game=t,this.headRadius=20,this.color="#0BDA51",this.color="#549D00",this.sound=new Audio("nom.mp3"),this.reset()}o.prototype.reset=function(){this.pos=[this.game.DIM_X/2,this.game.DIM_Y-50],this.vel=[0,-1],this.speed=8,this.body=[],this.maxLength=40,this.stomach=[],this.stomachSize=8,this.invincible=!1,this.powers=[],this.usedTurtle=!1},o.prototype.move=function(){this.body.unshift(this.pos.slice()),this.body.length>=this.maxLength&&this.body.pop(),this.pos[0]+=this.speed*this.vel[0],this.pos[1]+=this.speed*this.vel[1]},o.prototype.draw=function(t){let e=s.direction(this.vel);this.invincible&&Math.random()>.5?t.fillStyle="orange":this.frozen?t.fillStyle="#ADD8E6":t.fillStyle=this.color,t.beginPath(),t.arc(this.pos[0],this.pos[1],this.headRadius,e+.3,e+3.5,!1),t.closePath(),t.fill(),t.beginPath(),t.arc(this.pos[0],this.pos[1],this.headRadius,e-.3,e-3.5,!0),t.closePath(),t.fill();let n=this.headRadius/1.5;this.body.forEach((function(e){t.beginPath(),t.arc(e[0],e[1],n,0,6.28,!1),t.closePath(),t.fill()})),t.fillStyle="black";let i=this.pos.slice();0===s.direction(this.vel)?(i[0]+=this.headRadius*this.vel[1]/2,i[1]-=Math.abs(this.headRadius*this.vel[0]/2)):(i[0]+=this.headRadius*this.vel[1]/2,i[1]+=this.headRadius*this.vel[0]/2),"died"===this.game.over?(t.beginPath(),t.moveTo(i[0]+5,i[1]+5),t.lineTo(i[0]-5,i[1]-5),t.stroke(),t.beginPath(),t.moveTo(i[0]-5,i[1]+5),t.lineTo(i[0]+5,i[1]-5),t.stroke()):(t.beginPath(),t.arc(i[0],i[1],2.5,0,6.28,!1),t.closePath(),t.fill())},o.prototype.turn=function(t){JSON.stringify(s.scale(t,-1))!=JSON.stringify(this.vel)&&(this.frozen||(this.vel=t))},o.prototype.outOfBounds=function(){return s.outOfBounds(this.pos,this.game,this.headRadius)},o.prototype.selfBite=function(){let t=!1,e=this.pos,n=this.speed;return this.body.forEach((function(i){s.hypotenuse(i,e)<n&&(t=!0)})),t},o.prototype.eat=function(t){this.sound.play(),this.maxLength+=20,this.game.score+=100*this.game.level,this.stomach.unshift(t.type),this.stomach.length>this.stomachSize&&this.stomach.pop(),this.game.destroy(t),this.checkPowers()},o.prototype.checkPowers=function(){let t=this,e=this.powers,n=3;e.includes("rabbit")&&(n=2);let s=[];r.forEach((function(t){e.includes(t)&&s.push(t)})),e=s,i.forEach((function(s){t.stomachContains(s,n)&&!e.includes(s)&&e.push(s)})),this.powers=e,e.includes("pig")?this.stomachSize=16:this.stomachSize=8,this.usedTurtle&&this.powers.splice(this.powers.indexOf("turtle"),1)},o.prototype.stomachContains=function(t,e){let n=0;return this.stomach.forEach((function(e){t===e&&n++})),n>=e},o.prototype.hurt=function(t){if(!this.invincible){this.powers.includes("turtle")?this.usedTurtle=!0:(t&&this.game.lives--,this.game.lives--),this.powers.splice(this.powers.indexOf("turtle",1)),this.invincible=!0;let e=this;setTimeout((function(){e.invincible=!1}),1500)}this.game.lives<=0&&(this.game.end(),this.game.over="died",this.game.message="YOU DIED")},o.prototype.nextLevel=function(){return this.maxLength>=this.game.winLength&&this.pos[0]>this.game.DIM_X/2-50&&this.pos[0]<this.game.DIM_X/2+50&&this.pos[1]<20},o.prototype.hit=function(t){if("water"!==t.type&&"fire"!==t.type||this.hurt(),"ice"===t.type){this.frozen=!0;let t=this;clearTimeout(this.frozenTime),this.frozenTime=setTimeout((()=>{t.frozen=!1}),100)}if("tornado"===t.type){const t=[[1,0],[-1,0],[0,1],[0,-1]];if(!this.tornadoProof){0===this.vel[0]?this.vel=t[Math.floor(2*Math.random())]:0===this.vel[1]&&(this.vel=t[Math.floor(2+2*Math.random())]),this.tornadoProof=!0;let e=this;clearTimeout(this.tornadoTime),this.tornadoTime=setTimeout((()=>{e.tornadoProof=!1}),800)}}},t.exports=o},839:function(t){const e={scale(t,e){return[t[0]*e,t[1]*e]},hypotenuse(t,e){return Math.hypot(t[0]-e[0],t[1]-e[1])},direction(t){return Math.atan2(t[1],t[0])},outOfBounds(t,e,n){return t[0]<=n||t[1]<=n||t[0]>=e.DIM_X-n||t[1]>=e.DIM_Y-n}};t.exports=e}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,n),r.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(){"use strict";const t=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++s)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},e={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const i=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,h=i>>2,u=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(l=64)),s.push(n[h],n[u],n[l],n[d])}return s.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((31&i)<<6|63&r)}else if(i>239&&i<365){const r=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[s++]=String.fromCharCode(55296+(r>>10)),e[s++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((15&i)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],r=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==r||null==o||null==a)throw Error();const c=i<<2|r>>4;if(s.push(c),64!==o){const t=r<<4&240|o>>2;if(s.push(t),64!==a){const t=o<<6&192|a;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},s=function(n){return function(n){const s=t(n);return e.encodeByteArray(s,!0)}(n).replace(/\./g,"")};class i{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function r(){return"object"==typeof indexedDB}function o(){return new Promise(((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class a extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,a.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,c.prototype.create)}}class c{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],r=i?function(t,e){return t.replace(h,((t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${r} (${s}).`;return new a(s,o,n)}}const h=/\{\$([^}]+)}/g;function u(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const n=t[i],r=e[i];if(l(n)&&l(r)){if(!u(n,r))return!1}else if(n!==r)return!1}for(const t of s)if(!n.includes(t))return!1;return!0}function l(t){return null!==t&&"object"==typeof t}function d(t,e=1e3,n=2){const s=e*Math.pow(n,t),i=Math.round(.5*s*(Math.random()-.5)*2);return Math.min(144e5,s+i)}function f(t){return t&&t._delegate?t._delegate:t}class p{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const g="[DEFAULT]";class m{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new i;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),s=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(s)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:g})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(s);return s}onInit(t,e){var n;const s=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&t(r,s),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===g?void 0:s),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var s;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:g:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class y{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new m(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const v=[];var w,b;(b=w||(w={}))[b.DEBUG=0]="DEBUG",b[b.VERBOSE=1]="VERBOSE",b[b.INFO=2]="INFO",b[b.WARN=3]="WARN",b[b.ERROR=4]="ERROR",b[b.SILENT=5]="SILENT";const E={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},I=w.INFO,T={[w.DEBUG]:"log",[w.VERBOSE]:"log",[w.INFO]:"info",[w.WARN]:"warn",[w.ERROR]:"error"},S=(t,e,...n)=>{if(e<t.logLevel)return;const s=(new Date).toISOString(),i=T[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${s}]  ${t.name}:`,...n)};class C{constructor(t){this.name=t,this._logLevel=I,this._logHandler=S,this._userLogHandler=null,v.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in w))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?E[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,w.DEBUG,...t),this._logHandler(this,w.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,w.VERBOSE,...t),this._logHandler(this,w.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,w.INFO,...t),this._logHandler(this,w.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,w.WARN,...t),this._logHandler(this,w.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,w.ERROR,...t),this._logHandler(this,w.ERROR,...t)}}let D,A;const _=new WeakMap,k=new WeakMap,N=new WeakMap,L=new WeakMap,M=new WeakMap;let x={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return k.get(t);if("objectStoreNames"===e)return t.objectStoreNames||N.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return O(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function R(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(A||(A=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(P(this),t),O(_.get(this))}:function(...t){return O(e.apply(P(this),t))}:function(t,...n){const s=e.call(P(this),t,...n);return N.set(s,t.sort?t.sort():[t]),O(s)}:(t instanceof IDBTransaction&&function(t){if(k.has(t))return;const e=new Promise(((e,n)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",r),t.removeEventListener("abort",r)},i=()=>{e(),s()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",r),t.addEventListener("abort",r)}));k.set(t,e)}(t),n=t,(D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,x):t);var e,n}function O(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",r)},i=()=>{e(O(t.result)),s()},r=()=>{n(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&_.set(e,t)})).catch((()=>{})),M.set(e,t),e}(t);if(L.has(t))return L.get(t);const e=R(t);return e!==t&&(L.set(t,e),M.set(e,t)),e}const P=t=>M.get(t);function V(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=O(o);return s&&o.addEventListener("upgradeneeded",(t=>{s(O(o.result),t.oldVersion,t.newVersion,O(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),i&&t.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}const F=["get","getKey","getAll","getAllKeys","count"],U=["put","add","delete","clear"],B=new Map;function j(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(B.get(e))return B.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=U.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!i&&!F.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,i?"readwrite":"readonly");let o=r.store;return s&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&r.done]))[0]};return B.set(e,r),r}var q;q=x,x={...q,get:(t,e,n)=>j(t,e)||q.get(t,e,n),has:(t,e)=>!!j(t,e)||q.has(t,e)};class ${constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const K="@firebase/app",z="0.7.33",H=new C("@firebase/app"),G={[K]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},W=new Map,Q=new Map;function X(t,e){try{t.container.addComponent(e)}catch(n){H.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Y(t){const e=t.name;if(Q.has(e))return H.debug(`There were multiple attempts to register component ${e}.`),!1;Q.set(e,t);for(const e of W.values())X(e,t);return!0}function J(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const Z=new c("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class tt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new p("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Z.create("app-deleted",{appName:this._name})}}function et(t="[DEFAULT]"){const e=W.get(t);if(!e)throw Z.create("no-app",{appName:t});return e}function nt(t,e,n){var s;let i=null!==(s=G[t])&&void 0!==s?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${i}" with version "${e}":`];return r&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void H.warn(t.join(" "))}Y(new p(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const st="firebase-heartbeat-store";let it=null;function rt(){return it||(it=V("firebase-heartbeat-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(st)}}).catch((t=>{throw Z.create("idb-open",{originalErrorMessage:t.message})}))),it}async function ot(t,e){var n;try{const n=(await rt()).transaction(st,"readwrite"),s=n.objectStore(st);return await s.put(e,at(t)),n.done}catch(t){if(t instanceof a)H.warn(t.message);else{const e=Z.create("idb-set",{originalErrorMessage:null===(n=t)||void 0===n?void 0:n.message});H.warn(e.message)}}}function at(t){return`${t.name}!${t.options.appId}`}class ct{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new ut(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=ht();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=ht(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let s=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),lt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),lt(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function ht(){return(new Date).toISOString().substring(0,10)}class ut{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!r()&&o().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){var e;try{return(await rt()).transaction(st).objectStore(st).get(at(t))}catch(t){if(t instanceof a)H.warn(t.message);else{const n=Z.create("idb-get",{originalErrorMessage:null===(e=t)||void 0===e?void 0:e.message});H.warn(n.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ot(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ot(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function lt(t){return s(JSON.stringify({version:2,heartbeats:t})).length}Y(new p("platform-logger",(t=>new $(t)),"PRIVATE")),Y(new p("heartbeat",(t=>new ct(t)),"PRIVATE")),nt(K,z,""),nt(K,z,"esm2017"),nt("fire-js",""),nt("firebase","9.10.0","app");const dt="@firebase/installations",ft="0.5.12",pt="w:0.5.12",gt=new c("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function mt(t){return t instanceof a&&t.code.includes("request-failed")}function yt({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function vt(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function wt(t,e){const n=(await e.json()).error;return gt.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function bt({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Et(t){const e=await t();return e.status>=500&&e.status<600?t():e}function It(t){return new Promise((e=>{setTimeout(e,t)}))}const Tt=/^[cdef][\w-]{21}$/;function St(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}(t);return Tt.test(e)?e:""}catch(t){return""}}function Ct(t){return`${t.appName}!${t.appId}`}const Dt=new Map;function At(t,e){const n=Ct(t);_t(n,e),function(t,e){const n=(!kt&&"BroadcastChannel"in self&&(kt=new BroadcastChannel("[Firebase] FID Change"),kt.onmessage=t=>{_t(t.data.key,t.data.fid)}),kt);n&&n.postMessage({key:t,fid:e}),0===Dt.size&&kt&&(kt.close(),kt=null)}(n,e)}function _t(t,e){const n=Dt.get(t);if(n)for(const t of n)t(e)}let kt=null;const Nt="firebase-installations-store";let Lt=null;function Mt(){return Lt||(Lt=V("firebase-installations-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(Nt)}})),Lt}async function xt(t,e){const n=Ct(t),s=(await Mt()).transaction(Nt,"readwrite"),i=s.objectStore(Nt),r=await i.get(n);return await i.put(e,n),await s.done,r&&r.fid===e.fid||At(t,e.fid),e}async function Rt(t){const e=Ct(t),n=(await Mt()).transaction(Nt,"readwrite");await n.objectStore(Nt).delete(e),await n.done}async function Ot(t,e){const n=Ct(t),s=(await Mt()).transaction(Nt,"readwrite"),i=s.objectStore(Nt),r=await i.get(n),o=e(r);return void 0===o?await i.delete(n):await i.put(o,n),await s.done,!o||r&&r.fid===o.fid||At(t,o.fid),o}async function Pt(t){let e;const n=await Ot(t.appConfig,(n=>{const s=function(t){return Ut(t||{fid:St(),registrationStatus:0})}(n),i=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(gt.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const s=yt(t),i=bt(t),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={fid:n,authVersion:"FIS_v2",appId:t.appId,sdkVersion:pt},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Et((()=>fetch(s,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:vt(t.authToken)}}throw await wt("Create Installation",c)}(t,e);return xt(t.appConfig,n)}catch(n){throw mt(n)&&409===n.customData.serverCode?await Rt(t.appConfig):await xt(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:s}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:Vt(t)}:{installationEntry:e}}(t,s);return e=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function Vt(t){let e=await Ft(t.appConfig);for(;1===e.registrationStatus;)await It(100),e=await Ft(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await Pt(t);return n||e}return e}function Ft(t){return Ot(t,(t=>{if(!t)throw gt.create("installation-not-found");return Ut(t)}))}function Ut(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Bt({appConfig:t,heartbeatServiceProvider:e},n){const s=function(t,{fid:e}){return`${yt(t)}/${e}/authTokens:generate`}(t,n),i=function(t,{refreshToken:e}){const n=bt(t);return n.append("Authorization",function(t){return`FIS_v2 ${t}`}(e)),n}(t,n),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={installation:{sdkVersion:pt,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Et((()=>fetch(s,a)));if(c.ok)return vt(await c.json());throw await wt("Generate Auth Token",c)}async function jt(t,e=!1){let n;const s=await Ot(t.appConfig,(s=>{if(!$t(s))throw gt.create("not-registered");const i=s.authToken;if(!e&&(2===(r=i).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(r)))return s;var r;if(1===i.requestStatus)return n=async function(t,e){let n=await qt(t.appConfig);for(;1===n.authToken.requestStatus;)await It(100),n=await qt(t.appConfig);const s=n.authToken;return 0===s.requestStatus?jt(t,e):s}(t,e),s;{if(!navigator.onLine)throw gt.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(s);return n=async function(t,e){try{const n=await Bt(t,e),s=Object.assign(Object.assign({},e),{authToken:n});return await xt(t.appConfig,s),n}catch(n){if(!mt(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await xt(t.appConfig,n)}else await Rt(t.appConfig);throw n}}(t,e),e}}));return n?await n:s.authToken}function qt(t){return Ot(t,(t=>{if(!$t(t))throw gt.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function $t(t){return void 0!==t&&2===t.registrationStatus}function Kt(t){return gt.create("missing-app-config-values",{valueName:t})}const zt="installations";Y(new p(zt,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Kt("App Configuration");if(!t.name)throw Kt("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Kt(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:J(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Y(new p("installations-internal",(t=>{const e=J(t.getProvider("app").getImmediate(),zt).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:s}=await Pt(e);return s?s.catch(console.error):jt(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await Pt(t);e&&await e}(n),(await jt(n,e)).token}(e,t)}}),"PRIVATE")),nt(dt,ft),nt(dt,ft,"esm2017");const Ht="analytics",Gt="https://www.googletagmanager.com/gtag/js",Wt=new C("@firebase/analytics");function Qt(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Xt=new c("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Yt=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Jt(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Zt(t,e=Yt,n){const{appId:s,apiKey:i,measurementId:r}=t.options;if(!s)throw Xt.create("no-app-id");if(!i){if(r)return{measurementId:r,appId:s};throw Xt.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new ee;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),te({appId:s,apiKey:i,measurementId:r},o,a,e)}async function te(t,{throttleEndTimeMillis:e,backoffCount:n},s,i=Yt){var r,o;const{appId:c,measurementId:h}=t;try{await function(t,e){return new Promise(((n,s)=>{const i=Math.max(e-Date.now(),0),r=setTimeout(n,i);t.addEventListener((()=>{clearTimeout(r),s(Xt.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(s,e)}catch(t){if(h)return Wt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${null===(r=t)||void 0===r?void 0:r.message}]`),{appId:c,measurementId:h};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:s}=t,i={method:"GET",headers:Jt(s)},r="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(r,i);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Xt.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return i.deleteThrottleMetadata(c),e}catch(e){const r=e;if(!function(t){if(!(t instanceof a&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(r)){if(i.deleteThrottleMetadata(c),h)return Wt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${null==r?void 0:r.message}]`),{appId:c,measurementId:h};throw e}const u=503===Number(null===(o=null==r?void 0:r.customData)||void 0===o?void 0:o.httpStatus)?d(n,i.intervalMillis,30):d(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(c,l),Wt.debug(`Calling attemptFetch again in ${u} millis`),te(t,l,s,i)}}class ee{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let ne,se;async function ie(t,e,n,s,i,a,c){var h;const u=Zt(t);u.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Wt.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Wt.error(t))),e.push(u);const l=async function(){var t;if(!r())return Wt.warn(Xt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await o()}catch(e){return Wt.warn(Xt.create("indexeddb-unavailable",{errorInfo:null===(t=e)||void 0===t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?s.getId():void 0)),[d,f]=await Promise.all([u,l]);(function(){const t=window.document.getElementsByTagName("script");for(const e of Object.values(t))if(e.src&&e.src.includes(Gt))return e;return null})()||function(t,e){const n=document.createElement("script");n.src=`${Gt}?l=${t}&id=${e}`,n.async=!0,document.head.appendChild(n)}(a,d.measurementId),se&&(i("consent","default",se),se=void 0),i("js",new Date);const p=null!==(h=null==c?void 0:c.config)&&void 0!==h?h:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),i("config",d.measurementId,p),ne&&(i("set",ne),ne=void 0),d.measurementId}class re{constructor(t){this.app=t}_delete(){return delete oe[this.app.options.appId],Promise.resolve()}}let oe={},ae=[];const ce={};let he,ue,le="dataLayer",de=!1;function fe(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Xt.create("invalid-analytics-context",{errorInfo:e});Wt.warn(n.message)}}();const s=t.options.appId;if(!s)throw Xt.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Xt.create("no-api-key");Wt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=oe[s])throw Xt.create("already-exists",{id:s});if(!de){!function(t){let e=[];Array.isArray(window.dataLayer)?e=window.dataLayer:window.dataLayer=e}();const{wrappedGtag:t,gtagCore:e}=function(t,e,n,s,i){let r=function(...t){window.dataLayer.push(arguments)};return window.gtag&&"function"==typeof window.gtag&&(r=window.gtag),window.gtag=function(t,e,n,s){return async function(i,r,o){try{"event"===i?await async function(t,e,n,s,i){try{let r=[];if(i&&i.send_to){let t=i.send_to;Array.isArray(t)||(t=[t]);const s=await Qt(n);for(const n of t){const t=s.find((t=>t.measurementId===n)),i=t&&e[t.appId];if(!i){r=[];break}r.push(i)}}0===r.length&&(r=Object.values(e)),await Promise.all(r),t("event",s,i||{})}catch(t){Wt.error(t)}}(t,e,n,r,o):"config"===i?await async function(t,e,n,s,i,r){const o=s[i];try{if(o)await e[o];else{const t=(await Qt(n)).find((t=>t.measurementId===i));t&&await e[t.appId]}}catch(t){Wt.error(t)}t("config",i,r)}(t,e,n,s,r,o):"consent"===i?t("consent","update",o):t("set",r)}catch(t){Wt.error(t)}}}(r,t,e,n),{gtagCore:r,wrappedGtag:window.gtag}}(oe,ae,ce);ue=t,he=e,de=!0}return oe[s]=ie(t,ae,ce,e,he,le,n),new re(t)}const pe="@firebase/analytics",ge="0.8.0";Y(new p(Ht,((t,{options:e})=>fe(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),Y(new p("analytics-internal",(function(t){try{const e=t.getProvider(Ht).getImmediate();return{logEvent:(t,n,s)=>function(t,e,n,s){t=f(t),async function(t,e,n,s,i){if(i&&i.global)t("event",n,s);else{const i=await e;t("event",n,Object.assign(Object.assign({},s),{send_to:i}))}}(ue,oe[t.app.options.appId],e,n,s).catch((t=>Wt.error(t)))}(e,t,n,s)}}catch(t){throw Xt.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),nt(pe,ge),nt(pe,ge,"esm2017");var me,ye="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},ve={},we=we||{},be=ye||self;function Ee(){}function Ie(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Te(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Se="closure_uid_"+(1e9*Math.random()>>>0),Ce=0;function De(t,e,n){return t.call.apply(t.bind,arguments)}function Ae(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function _e(t,e,n){return(_e=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?De:Ae).apply(null,arguments)}function ke(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Ne(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}function Le(){this.s=this.s,this.o=this.o}var Me={};Le.prototype.s=!1,Le.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,Se)&&t[Se]||(t[Se]=++Ce)}(this);delete Me[t]}},Le.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const xe=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Re(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function Oe(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Ie(n)){const e=t.length||0,s=n.length||0;t.length=e+s;for(let i=0;i<s;i++)t[e+i]=n[i]}else t.push(n)}}function Pe(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Pe.prototype.h=function(){this.defaultPrevented=!0};var Ve=function(){if(!be.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{be.addEventListener("test",Ee,e),be.removeEventListener("test",Ee,e)}catch(t){}return t}();function Fe(t){return/^[\s\xa0]*$/.test(t)}var Ue=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Be(t,e){return t<e?-1:t>e?1:0}function je(){var t=be.navigator;return t&&(t=t.userAgent)?t:""}function qe(t){return-1!=je().indexOf(t)}function $e(t){return $e[" "](t),t}$e[" "]=Ee;var Ke,ze,He=qe("Opera"),Ge=qe("Trident")||qe("MSIE"),We=qe("Edge"),Qe=We||Ge,Xe=qe("Gecko")&&!(-1!=je().toLowerCase().indexOf("webkit")&&!qe("Edge"))&&!(qe("Trident")||qe("MSIE"))&&!qe("Edge"),Ye=-1!=je().toLowerCase().indexOf("webkit")&&!qe("Edge");function Je(){var t=be.document;return t?t.documentMode:void 0}t:{var Ze="",tn=(ze=je(),Xe?/rv:([^\);]+)(\)|;)/.exec(ze):We?/Edge\/([\d\.]+)/.exec(ze):Ge?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ze):Ye?/WebKit\/(\S+)/.exec(ze):He?/(?:Version)[ \/]?(\S+)/.exec(ze):void 0);if(tn&&(Ze=tn?tn[1]:""),Ge){var en=Je();if(null!=en&&en>parseFloat(Ze)){Ke=String(en);break t}}Ke=Ze}var nn,sn={};function rn(){return function(t){var e=sn;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let t=0;const e=Ue(String(Ke)).split("."),n=Ue("9").split("."),s=Math.max(e.length,n.length);for(let o=0;0==t&&o<s;o++){var i=e[o]||"",r=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==i[0].length&&0==r[0].length)break;t=Be(0==i[1].length?0:parseInt(i[1],10),0==r[1].length?0:parseInt(r[1],10))||Be(0==i[2].length,0==r[2].length)||Be(i[2],r[2]),i=i[3],r=r[3]}while(0==t)}return 0<=t}()}()}be.document&&Ge?nn=Je()||parseInt(Ke,10)||void 0:nn=void 0;var on=nn;function an(t,e){if(Pe.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Xe){t:{try{$e(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:cn[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&an.X.h.call(this)}}Ne(an,Pe);var cn={2:"touch",3:"pen",4:"mouse"};an.prototype.h=function(){an.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var hn="closure_listenable_"+(1e6*Math.random()|0),un=0;function ln(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ha=i,this.key=++un,this.ba=this.ea=!1}function dn(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function fn(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function pn(t){const e={};for(const n in t)e[n]=t[n];return e}const gn="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mn(t,e){let n,s;for(let e=1;e<arguments.length;e++){for(n in s=arguments[e],s)t[n]=s[n];for(let e=0;e<gn.length;e++)n=gn[e],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function yn(t){this.src=t,this.g={},this.h=0}function vn(t,e){var n=e.type;if(n in t.g){var s,i=t.g[n],r=xe(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(dn(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function wn(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.ba&&r.listener==e&&r.capture==!!n&&r.ha==s)return i}return-1}yn.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=wn(t,e,s,i);return-1<o?(e=t[o],n||(e.ea=!1)):((e=new ln(e,this.src,r,!!s,i)).ea=n,t.push(e)),e};var bn="closure_lm_"+(1e6*Math.random()|0),En={};function In(t,e,n,s,i){if(s&&s.once)return Sn(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)In(t,e[r],n,s,i);return null}return n=Ln(n),t&&t[hn]?t.N(e,n,Te(s)?!!s.capture:!!s,i):Tn(t,e,n,!1,s,i)}function Tn(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=Te(i)?!!i.capture:!!i,a=kn(t);if(a||(t[bn]=a=new yn(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){const t=_n;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)Ve||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(An(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function Sn(t,e,n,s,i){if(Array.isArray(e)){for(var r=0;r<e.length;r++)Sn(t,e[r],n,s,i);return null}return n=Ln(n),t&&t[hn]?t.O(e,n,Te(s)?!!s.capture:!!s,i):Tn(t,e,n,!0,s,i)}function Cn(t,e,n,s,i){if(Array.isArray(e))for(var r=0;r<e.length;r++)Cn(t,e[r],n,s,i);else s=Te(s)?!!s.capture:!!s,n=Ln(n),t&&t[hn]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=wn(r=t.g[e],n,s,i))&&(dn(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=kn(t))&&(e=t.g[e.toString()],t=-1,e&&(t=wn(e,n,s,i)),(n=-1<t?e[t]:null)&&Dn(n))}function Dn(t){if("number"!=typeof t&&t&&!t.ba){var e=t.src;if(e&&e[hn])vn(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(An(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=kn(e))?(vn(n,t),0==n.h&&(n.src=null,e[bn]=null)):dn(t)}}}function An(t){return t in En?En[t]:En[t]="on"+t}function _n(t,e){if(t.ba)t=!0;else{e=new an(e,this);var n=t.listener,s=t.ha||t.src;t.ea&&Dn(t),t=n.call(s,e)}return t}function kn(t){return(t=t[bn])instanceof yn?t:null}var Nn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ln(t){return"function"==typeof t?t:(t[Nn]||(t[Nn]=function(e){return t.handleEvent(e)}),t[Nn])}function Mn(){Le.call(this),this.i=new yn(this),this.P=this,this.I=null}function xn(t,e){var n,s=t.I;if(s)for(n=[];s;s=s.I)n.push(s);if(t=t.P,s=e.type||e,"string"==typeof e)e=new Pe(e,t);else if(e instanceof Pe)e.target=e.target||t;else{var i=e;mn(e=new Pe(s,t),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];i=Rn(o,s,!0,e)&&i}if(i=Rn(o=e.g=t,s,!0,e)&&i,i=Rn(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)i=Rn(o=e.g=n[r],s,!1,e)&&i}function Rn(t,e,n,s){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&vn(t.i,o),i=!1!==a.call(c,s)&&i}}return i&&!s.defaultPrevented}Ne(Mn,Le),Mn.prototype[hn]=!0,Mn.prototype.removeEventListener=function(t,e,n,s){Cn(this,t,e,n,s)},Mn.prototype.M=function(){if(Mn.X.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],s=0;s<n.length;s++)dn(n[s]);delete e.g[t],e.h--}}this.I=null},Mn.prototype.N=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)},Mn.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};var On=be.JSON.stringify;function Pn(){var t=$n;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Vn,Fn=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Un),(t=>t.reset()));class Un{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Bn(t){be.setTimeout((()=>{throw t}),0)}function jn(t,e){Vn||function(){var t=be.Promise.resolve(void 0);Vn=function(){t.then(Kn)}}(),qn||(Vn(),qn=!0),$n.add(t,e)}var qn=!1,$n=new class{constructor(){this.h=this.g=null}add(t,e){const n=Fn.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function Kn(){for(var t;t=Pn();){try{t.h.call(t.g)}catch(t){Bn(t)}var e=Fn;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}qn=!1}function zn(t,e){Mn.call(this),this.h=t||1,this.g=e||be,this.j=_e(this.kb,this),this.l=Date.now()}function Hn(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}function Gn(t,e,n){if("function"==typeof t)n&&(t=_e(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_e(t.handleEvent,t)}return 2147483647<Number(e)?-1:be.setTimeout(t,e||0)}function Wn(t){t.g=Gn((()=>{t.g=null,t.i&&(t.i=!1,Wn(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Ne(zn,Mn),(me=zn.prototype).ca=!1,me.R=null,me.kb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),xn(this,"tick"),this.ca&&(Hn(this),this.start()))}},me.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},me.M=function(){zn.X.M.call(this),Hn(this),delete this.g};class Qn extends Le{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Wn(this)}M(){super.M(),this.g&&(be.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xn(t){Le.call(this),this.h=t,this.g={}}Ne(Xn,Le);var Yn=[];function Jn(t,e,n,s){Array.isArray(n)||(n&&(Yn[0]=n.toString()),n=Yn);for(var i=0;i<n.length;i++){var r=In(e,n[i],s||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Zn(t){fn(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Dn(t)}),t),t.g={}}function ts(){this.g=!0}function es(t,e,n,s){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return On(n)}catch(t){return e}}(t,n)+(s?" "+s:"")}))}Xn.prototype.M=function(){Xn.X.M.call(this),Zn(this)},Xn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ts.prototype.Aa=function(){this.g=!1},ts.prototype.info=function(){};var ns={},ss=null;function is(){return ss=ss||new Mn}function rs(t){Pe.call(this,ns.Oa,t)}function os(t){const e=is();xn(e,new rs(e,t))}function as(t,e){Pe.call(this,ns.STAT_EVENT,t),this.stat=e}function cs(t){const e=is();xn(e,new as(e,t))}function hs(t,e){Pe.call(this,ns.Pa,t),this.size=e}function us(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return be.setTimeout((function(){t()}),e)}ns.Oa="serverreachability",Ne(rs,Pe),ns.STAT_EVENT="statevent",Ne(as,Pe),ns.Pa="timingevent",Ne(hs,Pe);var ls={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,La:7,TIMEOUT:8,Cb:9},ds={qb:"complete",Mb:"success",Ma:"error",La:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function fs(){}function ps(t){return t.h||(t.h=t.i())}function gs(){}fs.prototype.h=null;var ms,ys={OPEN:"a",pb:"b",Ma:"c",Bb:"d"};function vs(){Pe.call(this,"d")}function ws(){Pe.call(this,"c")}function bs(){}function Es(t,e,n,s){this.l=t,this.j=e,this.m=n,this.U=s||1,this.S=new Xn(this),this.O=Ts,t=Qe?125:void 0,this.T=new zn(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Is}function Is(){this.i=null,this.g="",this.h=!1}Ne(vs,Pe),Ne(ws,Pe),Ne(bs,fs),bs.prototype.g=function(){return new XMLHttpRequest},bs.prototype.i=function(){return{}},ms=new bs;var Ts=45e3,Ss={},Cs={};function Ds(t,e,n){t.K=1,t.v=zs(Bs(e)),t.s=n,t.P=!0,As(t,null)}function As(t,e){t.F=Date.now(),Ls(t),t.A=Bs(t.v);var n=t.A,s=t.U;Array.isArray(s)||(s=[String(s)]),ii(n.i,"t",s),t.C=0,n=t.l.H,t.h=new Is,t.g=sr(t.l,n?e:null,!t.s),0<t.N&&(t.L=new Qn(_e(t.Ka,t,t.g),t.N)),Jn(t.S,t.g,"readystatechange",t.hb),e=t.H?pn(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),os(1),function(t,e,n,s,i,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var u=h[0];h=h[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.U,t.s)}function _s(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Da}function ks(t,e,n){let s,i=!0;for(;!t.I&&t.C<n.length;){if(s=Ns(t,n),s==Cs){4==e&&(t.o=4,cs(14),i=!1),es(t.j,t.m,null,"[Incomplete Response]");break}if(s==Ss){t.o=4,cs(15),es(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}es(t.j,t.m,s,null),Ps(t,s)}_s(t)&&s!=Cs&&s!=Ss&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,cs(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.$&&(t.$=!0,(e=t.l).g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qi(e),e.K=!0,cs(11))):(es(t.j,t.m,n,"[Invalid Chunked Response]"),Os(t),Rs(t))}function Ns(t,e){var n=t.C,s=e.indexOf("\n",n);return-1==s?Cs:(n=Number(e.substring(n,s)),isNaN(n)?Ss:(s+=1)+n>e.length?Cs:(e=e.substr(s,n),t.C=s+n,e))}function Ls(t){t.V=Date.now()+t.O,Ms(t,t.O)}function Ms(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=us(_e(t.fb,t),e)}function xs(t){t.B&&(be.clearTimeout(t.B),t.B=null)}function Rs(t){0==t.l.G||t.I||Ji(t.l,t)}function Os(t){xs(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Hn(t.T),Zn(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ps(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||ui(n.h,t)))if(!t.J&&ui(n.h,t)&&3==n.G){try{var s=n.Fa.g.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Yi(n),ji(n)}Wi(n),cs(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=us(_e(n.bb,n),6e3));if(1>=hi(n.h)&&n.ja){try{n.ja()}catch(t){}n.ja=void 0}}else tr(n,11)}else if((t.J||n.g==t)&&Yi(n),!Fe(e))for(i=n.Fa.g.parse(e),e=0;e<i.length;e++){let h=i[e];if(n.T=h[0],h=h[1],2==n.G)if("c"==h[0]){n.I=h[1],n.ka=h[2];const e=h[3];null!=e&&(n.ma=e,n.j.info("VER="+n.ma));const i=h[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));const u=h[5];null!=u&&"number"==typeof u&&0<u&&(s=1.5*u,n.J=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=s.h;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(li(r,r.h),r.h=null))}if(s.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(s.za=t,Ks(s.F,s.D,t))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=t;if((s=n).sa=nr(s,s.H?s.ka:null,s.V),o.J){di(s.h,o);var a=o,c=s.J;c&&a.setTimeout(c),a.B&&(xs(a),Ls(a)),s.g=o}else Gi(s);0<n.i.length&&$i(n)}else"stop"!=h[0]&&"close"!=h[0]||tr(n,7);else 3==n.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?tr(n,7):Bi(n):"noop"!=h[0]&&n.l&&n.l.wa(h),n.A=0)}os(4)}catch(t){}}function Vs(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Ie(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.oa&&"function"==typeof t.oa)return t.oa();if(!t.W||"function"!=typeof t.W){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Ie(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const s in t)e[n++]=s;return e}}}(t),s=function(t){if(t.W&&"function"==typeof t.W)return t.W();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Ie(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t),i=s.length,r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}(me=Es.prototype).setTimeout=function(t){this.O=t},me.hb=function(t){t=t.target;const e=this.L;e&&3==Ri(t)?e.l():this.Ka(t)},me.Ka=function(t){try{if(t==this.g)t:{const u=Ri(this.g);var e=this.g.Ea();const l=this.g.aa();if(!(3>u)&&(3!=u||Qe||this.g&&(this.h.h||this.g.fa()||Oi(this.g)))){this.I||4!=u||7==e||os(8==e||0>=l?3:2),xs(this);var n=this.g.aa();this.Y=n;e:if(_s(this)){var s=Oi(this.g);t="";var i=s.length,r=4==Ri(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Os(this),Rs(this);var o="";break e}this.h.i=new be.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:r&&e==i-1});s.splice(0,i),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(t,e,n,s,i,r,o){t.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.U,u,n),this.i){if(this.Z&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Fe(a)){var h=a;break e}}h=null}if(!(n=h)){this.i=!1,this.o=3,cs(12),Os(this),Rs(this);break t}es(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ps(this,n)}this.P?(ks(this,u,o),Qe&&this.i&&3==u&&(Jn(this.S,this.T,"tick",this.gb),this.T.start())):(es(this.j,this.m,o,null),Ps(this,o)),4==u&&Os(this),this.i&&!this.I&&(4==u?Ji(this.l,this):(this.i=!1,Ls(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,cs(12)):(this.o=0,cs(13)),Os(this),Rs(this)}}}catch(t){}},me.gb=function(){if(this.g){var t=Ri(this.g),e=this.g.fa();this.C<e.length&&(xs(this),ks(this,t,e),this.i&&4!=t&&Ls(this))}},me.cancel=function(){this.I=!0,Os(this)},me.fb=function(){this.B=null;const t=Date.now();0<=t-this.V?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(os(3),cs(17)),Os(this),this.o=2,Rs(this)):Ms(this,this.V-t)};var Fs=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Us(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Us){this.h=void 0!==e?e:t.h,js(this,t.j),this.s=t.s,this.g=t.g,qs(this,t.m),this.l=t.l,e=t.i;var n=new ti;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),$s(this,n),this.o=t.o}else t&&(n=String(t).match(Fs))?(this.h=!!e,js(this,n[1]||"",!0),this.s=Hs(n[2]||""),this.g=Hs(n[3]||"",!0),qs(this,n[4]),this.l=Hs(n[5]||"",!0),$s(this,n[6]||"",!0),this.o=Hs(n[7]||"")):(this.h=!!e,this.i=new ti(null,this.h))}function Bs(t){return new Us(t)}function js(t,e,n){t.j=n?Hs(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function qs(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function $s(t,e,n){e instanceof ti?(t.i=e,function(t,e){e&&!t.j&&(ei(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(ni(this,e),ii(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Gs(e,Js)),t.i=new ti(e,t.h))}function Ks(t,e,n){t.i.set(e,n)}function zs(t){return Ks(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Hs(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Gs(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ws),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ws(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Us.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Gs(e,Qs,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Gs(e,Qs,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Gs(n,"/"==n.charAt(0)?Ys:Xs,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Gs(n,Zs)),t.join("")};var Qs=/[#\/\?@]/g,Xs=/[#\?:]/g,Ys=/[#\?]/g,Js=/[#\?@]/g,Zs=/#/g;function ti(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function ei(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function ni(t,e){ei(t),e=ri(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function si(t,e){return ei(t),e=ri(t,e),t.g.has(e)}function ii(t,e,n){ni(t,e),0<n.length&&(t.i=null,t.g.set(ri(t,e),Re(n)),t.h+=n.length)}function ri(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function oi(t){this.l=t||ai,t=be.PerformanceNavigationTiming?0<(t=be.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(be.g&&be.g.Ga&&be.g.Ga()&&be.g.Ga().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(me=ti.prototype).add=function(t,e){ei(this),this.i=null,t=ri(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},me.forEach=function(t,e){ei(this),this.g.forEach((function(n,s){n.forEach((function(n){t.call(e,n,s,this)}),this)}),this)},me.oa=function(){ei(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let s=0;s<e.length;s++){const i=t[s];for(let t=0;t<i.length;t++)n.push(e[s])}return n},me.W=function(t){ei(this);let e=[];if("string"==typeof t)si(this,t)&&(e=e.concat(this.g.get(ri(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},me.set=function(t,e){return ei(this),this.i=null,si(this,t=ri(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},me.get=function(t,e){return t&&0<(t=this.W(t)).length?String(t[0]):e},me.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var s=e[n];const r=encodeURIComponent(String(s)),o=this.W(s);for(s=0;s<o.length;s++){var i=r;""!==o[s]&&(i+="="+encodeURIComponent(String(o[s]))),t.push(i)}}return this.i=t.join("&")};var ai=10;function ci(t){return!!t.h||!!t.g&&t.g.size>=t.j}function hi(t){return t.h?1:t.g?t.g.size:0}function ui(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function li(t,e){t.g?t.g.add(e):t.h=e}function di(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function fi(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return Re(t.i)}function pi(){}function gi(){this.g=new pi}function mi(t,e,n){const s=n||"";try{Vs(t,(function(t,n){let i=t;Te(t)&&(i=On(t)),e.push(s+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function yi(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}function vi(t){this.l=t.$b||null,this.j=t.ib||!1}function wi(t,e){Mn.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=bi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}oi.prototype.cancel=function(){if(this.i=fi(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},pi.prototype.stringify=function(t){return be.JSON.stringify(t,void 0)},pi.prototype.parse=function(t){return be.JSON.parse(t,void 0)},Ne(vi,fs),vi.prototype.g=function(){return new wi(this.l,this.j)},vi.prototype.i=function(t){return function(){return t}}({}),Ne(wi,Mn);var bi=0;function Ei(t){t.j.read().then(t.Sa.bind(t)).catch(t.ga.bind(t))}function Ii(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Ti(t)}function Ti(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(me=wi.prototype).open=function(t,e){if(this.readyState!=bi)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Ti(this)},me.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||be).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ga.bind(this))},me.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ii(this)),this.readyState=bi},me.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ti(this)),this.g&&(this.readyState=3,Ti(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ga.bind(this));else if(void 0!==be.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ei(this)}else t.text().then(this.Ua.bind(this),this.ga.bind(this))},me.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ii(this):Ti(this),3==this.readyState&&Ei(this)}},me.Ua=function(t){this.g&&(this.response=this.responseText=t,Ii(this))},me.Ta=function(t){this.g&&(this.response=t,Ii(this))},me.ga=function(){this.g&&Ii(this)},me.setRequestHeader=function(t,e){this.v.append(t,e)},me.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},me.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(wi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Si=be.JSON.parse;function Ci(t){Mn.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Di,this.K=this.L=!1}Ne(Ci,Mn);var Di="",Ai=/^https?$/i,_i=["POST","PUT"];function ki(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ni(t),Mi(t)}function Ni(t){t.D||(t.D=!0,xn(t,"complete"),xn(t,"error"))}function Li(t){if(t.h&&void 0!==we&&(!t.C[1]||4!=Ri(t)||2!=t.aa()))if(t.v&&4==Ri(t))Gn(t.Ha,0,t);else if(xn(t,"readystatechange"),4==Ri(t)){t.h=!1;try{const a=t.aa();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===a){var i=String(t.H).match(Fs)[1]||null;if(!i&&be.self&&be.self.location){var r=be.self.location.protocol;i=r.substr(0,r.length-1)}s=!Ai.test(i?i.toLowerCase():"")}n=s}if(n)xn(t,"complete"),xn(t,"success");else{t.m=6;try{var o=2<Ri(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.aa()+"]",Ni(t)}}finally{Mi(t)}}}function Mi(t,e){if(t.g){xi(t);const n=t.g,s=t.C[0]?Ee:null;t.g=null,t.C=null,e||xn(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function xi(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(be.clearTimeout(t.A),t.A=null)}function Ri(t){return t.g?t.g.readyState:0}function Oi(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Di:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Pi(t){let e="";return fn(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Vi(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=Pi(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ks(t,e,n))}function Fi(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ui(t){this.Ca=0,this.i=[],this.j=new ts,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.$a=this.U=0,this.Ya=Fi("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Wa=Fi("baseRetryDelayMs",5e3,t),this.ab=Fi("retryDelaySeedMs",1e4,t),this.Za=Fi("forwardChannelMaxRetries",2,t),this.ta=Fi("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Yb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new oi(t&&t.concurrentRequestLimit),this.Fa=new gi,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Xa=t&&t.Wb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Bi(t){if(qi(t),3==t.G){var e=t.U++,n=Bs(t.F);Ks(n,"SID",t.I),Ks(n,"RID",e),Ks(n,"TYPE","terminate"),zi(t,n),(e=new Es(t,t.j,e,void 0)).K=2,e.v=zs(Bs(n)),n=!1,be.navigator&&be.navigator.sendBeacon&&(n=be.navigator.sendBeacon(e.v.toString(),"")),!n&&be.Image&&((new Image).src=e.v,n=!0),n||(e.g=sr(e.l,null),e.g.da(e.v)),e.F=Date.now(),Ls(e)}er(t)}function ji(t){t.g&&(Qi(t),t.g.cancel(),t.g=null)}function qi(t){ji(t),t.u&&(be.clearTimeout(t.u),t.u=null),Yi(t),t.h.cancel(),t.m&&("number"==typeof t.m&&be.clearTimeout(t.m),t.m=null)}function $i(t){ci(t.h)||t.m||(t.m=!0,jn(t.Ja,t),t.C=0)}function Ki(t,e){var n;n=e?e.m:t.U++;const s=Bs(t.F);Ks(s,"SID",t.I),Ks(s,"RID",n),Ks(s,"AID",t.T),zi(t,s),t.o&&t.s&&Vi(s,t.o,t.s),n=new Es(t,t.j,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=Hi(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),li(t.h,n),Ds(n,s,e)}function zi(t,e){t.ia&&fn(t.ia,(function(t,n){Ks(e,n,t)})),t.l&&Vs({},(function(t,n){Ks(e,n,t)}))}function Hi(t,e,n){n=Math.min(t.i.length,n);var s=t.l?_e(t.l.Qa,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=e,0>n)e=Math.max(0,i[o].h-100),r=!1;else try{mi(a,t,"req"+n+"_")}catch(t){s&&s(a)}}if(r){s=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,s}function Gi(t){t.g||t.u||(t.Z=1,jn(t.Ia,t),t.A=0)}function Wi(t){return!(t.g||t.u||3<=t.A||(t.Z++,t.u=us(_e(t.Ia,t),Zi(t,t.A)),t.A++,0))}function Qi(t){null!=t.B&&(be.clearTimeout(t.B),t.B=null)}function Xi(t){t.g=new Es(t,t.j,"rpc",t.Z),null===t.o&&(t.g.H=t.s),t.g.N=0;var e=Bs(t.sa);Ks(e,"RID","rpc"),Ks(e,"SID",t.I),Ks(e,"CI",t.L?"0":"1"),Ks(e,"AID",t.T),Ks(e,"TYPE","xmlhttp"),zi(t,e),t.o&&t.s&&Vi(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=zs(Bs(e)),n.s=null,n.P=!0,As(n,t)}function Yi(t){null!=t.v&&(be.clearTimeout(t.v),t.v=null)}function Ji(t,e){var n=null;if(t.g==e){Yi(t),Qi(t),t.g=null;var s=2}else{if(!ui(t.h,e))return;n=e.D,di(t.h,e),s=1}if(0!=t.G)if(t.pa=e.Y,e.i)if(1==s){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;xn(s=is(),new hs(s,n,e,i)),$i(t)}else Gi(t);else if(3==(i=e.o)||0==i&&0<t.pa||!(1==s&&function(t,e){return!(hi(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.C>=(t.Ya?0:t.Za)||(t.m=us(_e(t.Ja,t,e),Zi(t,t.C)),t.C++,0)))}(t,e)||2==s&&Wi(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:tr(t,5);break;case 4:tr(t,10);break;case 3:tr(t,6);break;default:tr(t,2)}}function Zi(t,e){let n=t.Wa+Math.floor(Math.random()*t.ab);return t.l||(n*=2),n*e}function tr(t,e){if(t.j.info("Error code "+e),2==e){var n=null;t.l&&(n=null);var s=_e(t.jb,t);n||(n=new Us("//www.google.com/images/cleardot.gif"),be.location&&"http"==be.location.protocol||js(n,"https"),zs(n)),function(t,e){const n=new ts;if(be.Image){const s=new Image;s.onload=ke(yi,n,s,"TestLoadImage: loaded",!0,e),s.onerror=ke(yi,n,s,"TestLoadImage: error",!1,e),s.onabort=ke(yi,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=ke(yi,n,s,"TestLoadImage: timeout",!1,e),be.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=t}else e(!1)}(n.toString(),s)}else cs(2);t.G=0,t.l&&t.l.va(e),er(t),qi(t)}function er(t){if(t.G=0,t.la=[],t.l){const e=fi(t.h);0==e.length&&0==t.i.length||(Oe(t.la,e),Oe(t.la,t.i),t.h.i.length=0,Re(t.i),t.i.length=0),t.l.ua()}}function nr(t,e,n){var s=n instanceof Us?Bs(n):new Us(n,void 0);if(""!=s.g)e&&(s.g=e+"."+s.g),qs(s,s.m);else{var i=be.location;s=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var r=new Us(null,void 0);s&&js(r,s),e&&(r.g=e),i&&qs(r,i),n&&(r.l=n),s=r}return n=t.D,e=t.za,n&&e&&Ks(s,n,e),Ks(s,"VER",t.ma),zi(t,s),s}function sr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Da&&!t.ra?new Ci(new vi({ib:!0})):new Ci(t.ra)).L=t.H,e}function ir(){}function rr(){if(Ge&&!(10<=Number(on)))throw Error("Environmental error: no available transport.")}function or(t,e){Mn.call(this),this.g=new Ui(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Xb)&&!Fe(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Fe(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new hr(this)}function ar(t){vs.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function cr(){ws.call(this),this.status=1}function hr(t){this.g=t}(me=Ci.prototype).da=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ms.g(),this.C=this.u?ps(this.u):ps(ms),this.g.onreadystatechange=_e(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void ki(this,t)}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var i in s)n.set(i,s[i]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const t of s.keys())n.set(t,s.get(t))}s=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=be.FormData&&t instanceof be.FormData,!(0<=xe(_i,e))||s||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{xi(this),0<this.B&&((this.K=function(t){return Ge&&rn()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_e(this.qa,this)):this.A=Gn(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){ki(this,t)}},me.qa=function(){void 0!==we&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xn(this,"timeout"),this.abort(8))},me.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,xn(this,"complete"),xn(this,"abort"),Mi(this))},me.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Mi(this,!0)),Ci.X.M.call(this)},me.Ha=function(){this.s||(this.F||this.v||this.l?Li(this):this.eb())},me.eb=function(){Li(this)},me.aa=function(){try{return 2<Ri(this)?this.g.status:-1}catch(t){return-1}},me.fa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},me.Ra=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Si(e)}},me.Ea=function(){return this.m},me.Na=function(){return"string"==typeof this.j?this.j:String(this.j)},(me=Ui.prototype).ma=8,me.G=1,me.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new Es(this,this.j,t,void 0);let r=this.s;if(this.S&&(r?(r=pn(r),mn(r,this.S)):r=this.S),null!==this.o||this.N||(i.H=r,r=null),this.O)t:{for(var e=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Hi(this,i,e),Ks(n=Bs(this.F),"RID",t),Ks(n,"CVER",22),this.D&&Ks(n,"X-HTTP-Session-Id",this.D),zi(this,n),r&&(this.N?e="headers="+encodeURIComponent(String(Pi(r)))+"&"+e:this.o&&Vi(n,this.o,r)),li(this.h,i),this.Xa&&Ks(n,"TYPE","init"),this.O?(Ks(n,"$req",e),Ks(n,"SID","null"),i.Z=!0,Ds(i,n,null)):Ds(i,n,e),this.G=2}}else 3==this.G&&(t?Ki(this,t):0==this.i.length||ci(this.h)||Ki(this))},me.Ia=function(){if(this.u=null,Xi(this),this.$&&!(this.K||null==this.g||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=us(_e(this.cb,this),t)}},me.cb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,cs(10),ji(this),Xi(this))},me.bb=function(){null!=this.v&&(this.v=null,ji(this),Wi(this),cs(19))},me.jb=function(t){t?(this.j.info("Successfully pinged google.com"),cs(2)):(this.j.info("Failed to ping google.com"),cs(1))},(me=ir.prototype).xa=function(){},me.wa=function(){},me.va=function(){},me.ua=function(){},me.Qa=function(){},rr.prototype.g=function(t,e){return new or(t,e)},Ne(or,Mn),or.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;cs(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=nr(t,null,t.V),$i(t)},or.prototype.close=function(){Bi(this.g)},or.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=On(t),t=n);e.i.push(new class{constructor(t,e){this.h=t,this.g=e}}(e.$a++,t)),3==e.G&&$i(e)},or.prototype.M=function(){this.g.l=null,delete this.j,Bi(this.g),delete this.g,or.X.M.call(this)},Ne(ar,vs),Ne(cr,ws),Ne(hr,ir),hr.prototype.xa=function(){xn(this.g,"a")},hr.prototype.wa=function(t){xn(this.g,new ar(t))},hr.prototype.va=function(t){xn(this.g,new cr(t))},hr.prototype.ua=function(){xn(this.g,"b")},rr.prototype.createWebChannel=rr.prototype.g,or.prototype.send=or.prototype.u,or.prototype.open=or.prototype.m,or.prototype.close=or.prototype.close,ls.NO_ERROR=0,ls.TIMEOUT=8,ls.HTTP_ERROR=6,ds.COMPLETE="complete",gs.EventType=ys,ys.OPEN="a",ys.CLOSE="b",ys.ERROR="c",ys.MESSAGE="d",Mn.prototype.listen=Mn.prototype.N,Ci.prototype.listenOnce=Ci.prototype.O,Ci.prototype.getLastError=Ci.prototype.Na,Ci.prototype.getLastErrorCode=Ci.prototype.Ea,Ci.prototype.getStatus=Ci.prototype.aa,Ci.prototype.getResponseJson=Ci.prototype.Ra,Ci.prototype.getResponseText=Ci.prototype.fa,Ci.prototype.send=Ci.prototype.da;var ur=ve.createWebChannelTransport=function(){return new rr},lr=ve.getStatEventTarget=function(){return is()},dr=ve.ErrorCode=ls,fr=ve.EventType=ds,pr=ve.Event=ns,gr=ve.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},mr=ve.FetchXmlHttpFactory=vi,yr=ve.WebChannel=gs,vr=ve.XhrIo=Ci;const wr="@firebase/firestore";class br{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}br.UNAUTHENTICATED=new br(null),br.GOOGLE_CREDENTIALS=new br("google-credentials-uid"),br.FIRST_PARTY=new br("first-party-uid"),br.MOCK_USER=new br("mock-user");let Er="9.10.0";const Ir=new C("@firebase/firestore");function Tr(){return Ir.logLevel}function Sr(t,...e){if(Ir.logLevel<=w.DEBUG){const n=e.map(Ar);Ir.debug(`Firestore (${Er}): ${t}`,...n)}}function Cr(t,...e){if(Ir.logLevel<=w.ERROR){const n=e.map(Ar);Ir.error(`Firestore (${Er}): ${t}`,...n)}}function Dr(t,...e){if(Ir.logLevel<=w.WARN){const n=e.map(Ar);Ir.warn(`Firestore (${Er}): ${t}`,...n)}}function Ar(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _r(t="Unexpected state"){const e=`FIRESTORE (${Er}) INTERNAL ASSERTION FAILED: `+t;throw Cr(e),new Error(e)}function kr(t,e){t||_r()}function Nr(t,e){return t}const Lr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Mr extends a{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class xr{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Rr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Or{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(br.UNAUTHENTICATED)))}shutdown(){}}class Pr{constructor(t){this.t=t,this.currentUser=br.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new xr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new xr,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{Sr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Sr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new xr)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Sr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(kr("string"==typeof e.accessToken),new Rr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return kr(null===t||"string"==typeof t),new br(t)}}class Vr{constructor(t,e,n,s){this.h=t,this.l=e,this.m=n,this.g=s,this.type="FirstParty",this.user=br.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(kr(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.p.set("Authorization",t),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Fr{constructor(t,e,n,s){this.h=t,this.l=e,this.m=n,this.g=s}getToken(){return Promise.resolve(new Vr(this.h,this.l,this.m,this.g))}start(t,e){t.enqueueRetryable((()=>e(br.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ur{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Br{constructor(t){this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,e){const n=t=>{null!=t.error&&Sr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.A;return this.A=t.token,Sr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{Sr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.T.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.T.getImmediate({optional:!0});t?s(t):Sr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(kr("string"==typeof t.token),this.A=t.token,new Ur(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function jr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class qr{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=jr(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function $r(t,e){return t<e?-1:t>e?1:0}function Kr(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}class zr{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Mr(Lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Mr(Lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Mr(Lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Mr(Lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return zr.fromMillis(Date.now())}static fromDate(t){return zr.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new zr(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?$r(this.nanoseconds,t.nanoseconds):$r(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Hr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Hr(t)}static min(){return new Hr(new zr(0,0))}static max(){return new Hr(new zr(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Gr{constructor(t,e,n){void 0===e?e=0:e>t.length&&_r(),void 0===n?n=t.length-e:n>t.length-e&&_r(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Gr.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Gr?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Wr extends Gr{construct(t,e,n){return new Wr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Mr(Lr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Wr(e)}static emptyPath(){return new Wr([])}}const Qr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xr extends Gr{construct(t,e,n){return new Xr(t,e,n)}static isValidIdentifier(t){return Qr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xr.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Xr(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Mr(Lr.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Mr(Lr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Mr(Lr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new Mr(Lr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Xr(e)}static emptyPath(){return new Xr([])}}class Yr{constructor(t){this.path=t}static fromPath(t){return new Yr(Wr.fromString(t))}static fromName(t){return new Yr(Wr.fromString(t).popFirst(5))}static empty(){return new Yr(Wr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Wr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Wr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Yr(new Wr(t.slice()))}}function Jr(t){return new Zr(t.readTime,t.key,-1)}class Zr{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Zr(Hr.min(),Yr.empty(),-1)}static max(){return new Zr(Hr.max(),Yr.empty(),-1)}}function to(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Yr.comparator(t.documentKey,e.documentKey),0!==n?n:$r(t.largestBatchId,e.largestBatchId))}async function eo(t){if(t.code!==Lr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;Sr("LocalStore","Unexpectedly lost primary lease")}class no{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&_r(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new no(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof no?e:no.resolve(e)}catch(t){return no.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):no.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):no.reject(e)}static resolve(t){return new no(((e,n)=>{e(t)}))}static reject(t){return new no(((e,n)=>{n(t)}))}static waitFor(t){return new no(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=no.resolve(!1);for(const n of t)e=e.next((t=>t?no.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}static mapArray(t,e){return new no(((n,s)=>{const i=t.length,r=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{r[c]=t,++o,o===i&&n(r)}),(t=>s(t)))}}))}static doWhile(t,e){return new no(((n,s)=>{const i=()=>{!0===t()?e().next((()=>{i()}),s):n()};i()}))}}function so(t){return"IndexedDbTransactionError"===t.name}class io{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ut(t),this.ct=t=>e.writeSequenceNumber(t))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}function ro(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function oo(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ao(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}io.at=-1;class co{constructor(t,e){this.comparator=t,this.root=e||uo.EMPTY}insert(t,e){return new co(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,uo.BLACK,null,null))}remove(t){return new co(this.comparator,this.root.remove(t,this.comparator).copy(null,null,uo.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ho(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ho(this.root,t,this.comparator,!1)}getReverseIterator(){return new ho(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ho(this.root,t,this.comparator,!0)}}class ho{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class uo{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:uo.RED,this.left=null!=s?s:uo.EMPTY,this.right=null!=i?i:uo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new uo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return uo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return uo.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,uo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,uo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _r();if(this.right.isRed())throw _r();const t=this.left.check();if(t!==this.right.check())throw _r();return t+(this.isRed()?0:1)}}uo.EMPTY=null,uo.RED=!0,uo.BLACK=!1,uo.EMPTY=new class{constructor(){this.size=0}get key(){throw _r()}get value(){throw _r()}get color(){throw _r()}get left(){throw _r()}get right(){throw _r()}copy(t,e,n,s,i){return this}insert(t,e,n){return new uo(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class lo{constructor(t){this.comparator=t,this.data=new co(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new fo(this.data.getIterator())}getIteratorFrom(t){return new fo(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof lo))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new lo(this.comparator);return e.data=t,e}}class fo{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class po{constructor(t){this.fields=t,t.sort(Xr.comparator)}static empty(){return new po([])}unionWith(t){let e=new lo(Xr.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new po(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Kr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class go{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new go(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new go(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return $r(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}go.EMPTY_BYTE_STRING=new go("");const mo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yo(t){if(kr(!!t),"string"==typeof t){let e=0;const n=mo.exec(t);if(kr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:vo(t.seconds),nanos:vo(t.nanos)}}function vo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function wo(t){return"string"==typeof t?go.fromBase64String(t):go.fromUint8Array(t)}function bo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Eo(t){const e=t.mapValue.fields.__previous_value__;return bo(e)?Eo(e):e}function Io(t){const e=yo(t.mapValue.fields.__local_write_time__.timestampValue);return new zr(e.seconds,e.nanos)}class To{constructor(t,e,n,s,i,r,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class So{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new So("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof So&&t.projectId===this.projectId&&t.database===this.database}}function Co(t){return null==t}function Do(t){return 0===t&&1/t==-1/0}const Ao={fields:{__type__:{stringValue:"__max__"}}};function _o(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?bo(t)?4:jo(t)?9007199254740991:10:_r()}function ko(t,e){if(t===e)return!0;const n=_o(t);if(n!==_o(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Io(t).isEqual(Io(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=yo(t.timestampValue),s=yo(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return wo(t.bytesValue).isEqual(wo(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return vo(t.geoPointValue.latitude)===vo(e.geoPointValue.latitude)&&vo(t.geoPointValue.longitude)===vo(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return vo(t.integerValue)===vo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=vo(t.doubleValue),s=vo(e.doubleValue);return n===s?Do(n)===Do(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Kr(t.arrayValue.values||[],e.arrayValue.values||[],ko);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(ro(n)!==ro(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!ko(n[t],s[t])))return!1;return!0}(t,e);default:return _r()}}function No(t,e){return void 0!==(t.values||[]).find((t=>ko(t,e)))}function Lo(t,e){if(t===e)return 0;const n=_o(t),s=_o(e);if(n!==s)return $r(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return $r(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=vo(t.integerValue||t.doubleValue),s=vo(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Mo(t.timestampValue,e.timestampValue);case 4:return Mo(Io(t),Io(e));case 5:return $r(t.stringValue,e.stringValue);case 6:return function(t,e){const n=wo(t),s=wo(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=$r(n[t],s[t]);if(0!==e)return e}return $r(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=$r(vo(t.latitude),vo(e.latitude));return 0!==n?n:$r(vo(t.longitude),vo(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Lo(n[t],s[t]);if(e)return e}return $r(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Ao&&e===Ao)return 0;if(t===Ao)return 1;if(e===Ao)return-1;const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=$r(s[t],r[t]);if(0!==e)return e;const o=Lo(n[s[t]],i[r[t]]);if(0!==o)return o}return $r(s.length,r.length)}(t.mapValue,e.mapValue);default:throw _r()}}function Mo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return $r(t,e);const n=yo(t),s=yo(e),i=$r(n.seconds,s.seconds);return 0!==i?i:$r(n.nanos,s.nanos)}function xo(t){return Ro(t)}function Ro(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=yo(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?wo(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Yr.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Ro(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${Ro(t.fields[i])}`;return n+"}"}(t.mapValue):_r();var e,n}function Oo(t){return!!t&&"integerValue"in t}function Po(t){return!!t&&"arrayValue"in t}function Vo(t){return!!t&&"nullValue"in t}function Fo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Uo(t){return!!t&&"mapValue"in t}function Bo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return oo(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Bo(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Bo(t.arrayValue.values[n]);return e}return Object.assign({},t)}function jo(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class qo{constructor(t){this.value=t}static empty(){return new qo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Uo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Bo(e)}setAll(t){let e=Xr.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=Bo(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Uo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ko(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Uo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){oo(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new qo(Bo(this.value))}}function $o(t){const e=[];return oo(t.fields,((t,n)=>{const s=new Xr([t]);if(Uo(n)){const t=$o(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new po(e)}class Ko{constructor(t,e,n,s,i,r){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.data=i,this.documentState=r}static newInvalidDocument(t){return new Ko(t,0,Hr.min(),Hr.min(),qo.empty(),0)}static newFoundDocument(t,e,n){return new Ko(t,1,e,Hr.min(),n,0)}static newNoDocument(t,e){return new Ko(t,2,e,Hr.min(),qo.empty(),0)}static newUnknownDocument(t,e){return new Ko(t,3,e,Hr.min(),qo.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=qo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=qo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Hr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ko&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ko(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zo{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.ht=null}}function Ho(t,e=null,n=[],s=[],i=null,r=null,o=null){return new zo(t,e,n,s,i,r,o)}function Go(t){const e=Nr(t);if(null===e.ht){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+xo(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Co(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>xo(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>xo(t))).join(",")),e.ht=t}return e.ht}function Wo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!aa(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!ko(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ha(t.startAt,e.startAt)&&ha(t.endAt,e.endAt)}function Qo(t){return Yr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Xo extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.lt(t,e,n):new Yo(t,e,n):"array-contains"===e?new ea(t,n):"in"===e?new na(t,n):"not-in"===e?new sa(t,n):"array-contains-any"===e?new ia(t,n):new Xo(t,e,n)}static lt(t,e,n){return"in"===e?new Jo(t,n):new Zo(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.ft(Lo(e,this.value)):null!==e&&_o(this.value)===_o(e)&&this.ft(Lo(e,this.value))}ft(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _r()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Yo extends Xo{constructor(t,e,n){super(t,e,n),this.key=Yr.fromName(n.referenceValue)}matches(t){const e=Yr.comparator(t.key,this.key);return this.ft(e)}}class Jo extends Xo{constructor(t,e){super(t,"in",e),this.keys=ta(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Zo extends Xo{constructor(t,e){super(t,"not-in",e),this.keys=ta(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function ta(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Yr.fromName(t.referenceValue)))}class ea extends Xo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Po(e)&&No(e.arrayValue,this.value)}}class na extends Xo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&No(this.value.arrayValue,e)}}class sa extends Xo{constructor(t,e){super(t,"not-in",e)}matches(t){if(No(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!No(this.value.arrayValue,e)}}class ia extends Xo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Po(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>No(this.value.arrayValue,t)))}}class ra{constructor(t,e){this.position=t,this.inclusive=e}}class oa{constructor(t,e="asc"){this.field=t,this.dir=e}}function aa(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ca(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?Yr.comparator(Yr.fromName(o.referenceValue),n.key):Lo(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function ha(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ko(t.position[n],e.position[n]))return!1;return!0}class ua{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this._t=null,this.wt=null,this.startAt,this.endAt}}function la(t){return new ua(t)}function da(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function fa(t){const e=Nr(t);if(null===e._t){e._t=[];const t=function(t){for(const e of t.filters)if(e.dt())return e.field;return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e._t.push(new oa(t)),e._t.push(new oa(Xr.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e._t.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e._t.push(new oa(Xr.keyField(),t))}}}return e._t}function pa(t){const e=Nr(t);if(!e.wt)if("F"===e.limitType)e.wt=Ho(e.path,e.collectionGroup,fa(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of fa(e)){const e="desc"===n.dir?"asc":"desc";t.push(new oa(n.field,e))}const n=e.endAt?new ra(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new ra(e.startAt.position,e.startAt.inclusive):null;e.wt=Ho(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.wt}function ga(t,e,n){return new ua(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ma(t,e){return Wo(pa(t),pa(e))&&t.limitType===e.limitType}function ya(t){return`${Go(pa(t))}|lt:${t.limitType}`}function va(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${xo(e.value)}`;var e})).join(", ")}]`),Co(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>xo(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>xo(t))).join(",")),`Target(${e})`}(pa(t))}; limitType=${t.limitType})`}function wa(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Yr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=ca(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,fa(t),e)||t.endAt&&!function(t,e,n){const s=ca(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,fa(t),e))}(t,e)}function ba(t){return(e,n)=>{let s=!1;for(const i of fa(t)){const t=Ea(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function Ea(t,e,n){const s=t.field.isKeyField()?Yr.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?Lo(s,i):_r()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return _r()}}function Ia(t,e){if(t.gt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Do(e)?"-0":e}}function Ta(t){return{integerValue:""+t}}function Sa(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Do(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?Ta(e):Ia(t,e)}class Ca{constructor(){this._=void 0}}function Da(t,e,n){return t instanceof ka?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Na?La(t,e):t instanceof Ma?xa(t,e):function(t,e){const n=_a(t,e),s=Oa(n)+Oa(t.yt);return Oo(n)&&Oo(t.yt)?Ta(s):Ia(t.It,s)}(t,e)}function Aa(t,e,n){return t instanceof Na?La(t,e):t instanceof Ma?xa(t,e):n}function _a(t,e){return t instanceof Ra?Oo(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class ka extends Ca{}class Na extends Ca{constructor(t){super(),this.elements=t}}function La(t,e){const n=Pa(e);for(const e of t.elements)n.some((t=>ko(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Ma extends Ca{constructor(t){super(),this.elements=t}}function xa(t,e){let n=Pa(e);for(const e of t.elements)n=n.filter((t=>!ko(t,e)));return{arrayValue:{values:n}}}class Ra extends Ca{constructor(t,e){super(),this.It=t,this.yt=e}}function Oa(t){return vo(t.integerValue||t.doubleValue)}function Pa(t){return Po(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Va{constructor(t,e){this.version=t,this.transformResults=e}}class Fa{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Fa}static exists(t){return new Fa(void 0,t)}static updateTime(t){return new Fa(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ua(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ba{}function ja(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Ya(t.key,Fa.none()):new Ha(t.key,t.data,Fa.none());{const n=t.data,s=qo.empty();let i=new lo(Xr.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),i=i.add(t)}return new Ga(t.key,s,new po(i.toArray()),Fa.none())}}function qa(t,e,n){t instanceof Ha?function(t,e,n){const s=t.value.clone(),i=Qa(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Ga?function(t,e,n){if(!Ua(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=Qa(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Wa(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function $a(t,e,n,s){return t instanceof Ha?function(t,e,n,s){if(!Ua(t.precondition,e))return n;const i=t.value.clone(),r=Xa(t.fieldTransforms,s,e);return i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,s):t instanceof Ga?function(t,e,n,s){if(!Ua(t.precondition,e))return n;const i=Xa(t.fieldTransforms,s,e),r=e.data;return r.setAll(Wa(t)),r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,s):function(t,e,n){return Ua(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Ka(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=_a(s.transform,t||null);null!=i&&(null===n&&(n=qo.empty()),n.set(s.field,i))}return n||null}function za(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Kr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Na&&e instanceof Na||t instanceof Ma&&e instanceof Ma?Kr(t.elements,e.elements,ko):t instanceof Ra&&e instanceof Ra?ko(t.yt,e.yt):t instanceof ka&&e instanceof ka}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ha extends Ba{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ga extends Ba{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Wa(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function Qa(t,e,n){const s=new Map;kr(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,a=e.data.field(r.field);s.set(r.field,Aa(o,a,n[i]))}return s}function Xa(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,Da(t,r,e))}return s}class Ya extends Ba{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ja extends Ba{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Za{constructor(t){this.count=t}}var tc,ec;function nc(t){if(void 0===t)return Cr("GRPC error has no .code"),Lr.UNKNOWN;switch(t){case tc.OK:return Lr.OK;case tc.CANCELLED:return Lr.CANCELLED;case tc.UNKNOWN:return Lr.UNKNOWN;case tc.DEADLINE_EXCEEDED:return Lr.DEADLINE_EXCEEDED;case tc.RESOURCE_EXHAUSTED:return Lr.RESOURCE_EXHAUSTED;case tc.INTERNAL:return Lr.INTERNAL;case tc.UNAVAILABLE:return Lr.UNAVAILABLE;case tc.UNAUTHENTICATED:return Lr.UNAUTHENTICATED;case tc.INVALID_ARGUMENT:return Lr.INVALID_ARGUMENT;case tc.NOT_FOUND:return Lr.NOT_FOUND;case tc.ALREADY_EXISTS:return Lr.ALREADY_EXISTS;case tc.PERMISSION_DENIED:return Lr.PERMISSION_DENIED;case tc.FAILED_PRECONDITION:return Lr.FAILED_PRECONDITION;case tc.ABORTED:return Lr.ABORTED;case tc.OUT_OF_RANGE:return Lr.OUT_OF_RANGE;case tc.UNIMPLEMENTED:return Lr.UNIMPLEMENTED;case tc.DATA_LOSS:return Lr.DATA_LOSS;default:return _r()}}(ec=tc||(tc={}))[ec.OK=0]="OK",ec[ec.CANCELLED=1]="CANCELLED",ec[ec.UNKNOWN=2]="UNKNOWN",ec[ec.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ec[ec.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ec[ec.NOT_FOUND=5]="NOT_FOUND",ec[ec.ALREADY_EXISTS=6]="ALREADY_EXISTS",ec[ec.PERMISSION_DENIED=7]="PERMISSION_DENIED",ec[ec.UNAUTHENTICATED=16]="UNAUTHENTICATED",ec[ec.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ec[ec.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ec[ec.ABORTED=10]="ABORTED",ec[ec.OUT_OF_RANGE=11]="OUT_OF_RANGE",ec[ec.UNIMPLEMENTED=12]="UNIMPLEMENTED",ec[ec.INTERNAL=13]="INTERNAL",ec[ec.UNAVAILABLE=14]="UNAVAILABLE",ec[ec.DATA_LOSS=15]="DATA_LOSS";class sc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){oo(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return ao(this.inner)}size(){return this.innerSize}}const ic=new co(Yr.comparator);function rc(){return ic}const oc=new co(Yr.comparator);function ac(...t){let e=oc;for(const n of t)e=e.insert(n.key,n);return e}function cc(t){let e=oc;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function hc(){return lc()}function uc(){return lc()}function lc(){return new sc((t=>t.toString()),((t,e)=>t.isEqual(e)))}const dc=new co(Yr.comparator),fc=new lo(Yr.comparator);function pc(...t){let e=fc;for(const n of t)e=e.add(n);return e}const gc=new lo($r);function mc(){return gc}class yc{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,vc.createSynthesizedTargetChangeForCurrentChange(t,e)),new yc(Hr.min(),n,mc(),rc(),pc())}}class vc{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new vc(go.EMPTY_BYTE_STRING,e,pc(),pc(),pc())}}class wc{constructor(t,e,n,s){this.Tt=t,this.removedTargetIds=e,this.key=n,this.Et=s}}class bc{constructor(t,e){this.targetId=t,this.At=e}}class Ec{constructor(t,e,n=go.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Ic{constructor(){this.Rt=0,this.bt=Cc(),this.Pt=go.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(t){t.approximateByteSize()>0&&(this.Vt=!0,this.Pt=t)}xt(){let t=pc(),e=pc(),n=pc();return this.bt.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:_r()}})),new vc(this.Pt,this.vt,t,e,n)}Nt(){this.Vt=!1,this.bt=Cc()}kt(t,e){this.Vt=!0,this.bt=this.bt.insert(t,e)}Mt(t){this.Vt=!0,this.bt=this.bt.remove(t)}Ot(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class Tc{constructor(t){this.Bt=t,this.Lt=new Map,this.Ut=rc(),this.qt=Sc(),this.Kt=new lo($r)}Gt(t){for(const e of t.Tt)t.Et&&t.Et.isFoundDocument()?this.Qt(e,t.Et):this.jt(e,t.key,t.Et);for(const e of t.removedTargetIds)this.jt(e,t.key,t.Et)}Wt(t){this.forEachTarget(t,(e=>{const n=this.zt(e);switch(t.state){case 0:this.Ht(e)&&n.Ct(t.resumeToken);break;case 1:n.Ft(),n.St||n.Nt(),n.Ct(t.resumeToken);break;case 2:n.Ft(),n.St||this.removeTarget(e);break;case 3:this.Ht(e)&&(n.$t(),n.Ct(t.resumeToken));break;case 4:this.Ht(e)&&(this.Jt(e),n.Ct(t.resumeToken));break;default:_r()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Lt.forEach(((t,n)=>{this.Ht(n)&&e(n)}))}Yt(t){const e=t.targetId,n=t.At.count,s=this.Xt(e);if(s){const t=s.target;if(Qo(t))if(0===n){const n=new Yr(t.path);this.jt(e,n,Ko.newNoDocument(n,Hr.min()))}else kr(1===n);else this.Zt(e)!==n&&(this.Jt(e),this.Kt=this.Kt.add(e))}}te(t){const e=new Map;this.Lt.forEach(((n,s)=>{const i=this.Xt(s);if(i){if(n.current&&Qo(i.target)){const e=new Yr(i.target.path);null!==this.Ut.get(e)||this.ee(s,e)||this.jt(s,e,Ko.newNoDocument(e,t))}n.Dt&&(e.set(s,n.xt()),n.Nt())}}));let n=pc();this.qt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.Xt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.Ut.forEach(((e,n)=>n.setReadTime(t)));const s=new yc(t,e,this.Kt,this.Ut,n);return this.Ut=rc(),this.qt=Sc(),this.Kt=new lo($r),s}Qt(t,e){if(!this.Ht(t))return;const n=this.ee(t,e.key)?2:0;this.zt(t).kt(e.key,n),this.Ut=this.Ut.insert(e.key,e),this.qt=this.qt.insert(e.key,this.ne(e.key).add(t))}jt(t,e,n){if(!this.Ht(t))return;const s=this.zt(t);this.ee(t,e)?s.kt(e,1):s.Mt(e),this.qt=this.qt.insert(e,this.ne(e).delete(t)),n&&(this.Ut=this.Ut.insert(e,n))}removeTarget(t){this.Lt.delete(t)}Zt(t){const e=this.zt(t).xt();return this.Bt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ot(t){this.zt(t).Ot()}zt(t){let e=this.Lt.get(t);return e||(e=new Ic,this.Lt.set(t,e)),e}ne(t){let e=this.qt.get(t);return e||(e=new lo($r),this.qt=this.qt.insert(t,e)),e}Ht(t){const e=null!==this.Xt(t);return e||Sr("WatchChangeAggregator","Detected inactive target",t),e}Xt(t){const e=this.Lt.get(t);return e&&e.St?null:this.Bt.se(t)}Jt(t){this.Lt.set(t,new Ic),this.Bt.getRemoteKeysForTarget(t).forEach((e=>{this.jt(t,e,null)}))}ee(t,e){return this.Bt.getRemoteKeysForTarget(t).has(e)}}function Sc(){return new co(Yr.comparator)}function Cc(){return new co(Yr.comparator)}const Dc={asc:"ASCENDING",desc:"DESCENDING"},Ac={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class _c{constructor(t,e){this.databaseId=t,this.gt=e}}function kc(t,e){return t.gt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Nc(t,e){return t.gt?e.toBase64():e.toUint8Array()}function Lc(t,e){return kc(t,e.toTimestamp())}function Mc(t){return kr(!!t),Hr.fromTimestamp(function(t){const e=yo(t);return new zr(e.seconds,e.nanos)}(t))}function xc(t,e){return function(t){return new Wr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Rc(t){const e=Wr.fromString(t);return kr(Jc(e)),e}function Oc(t,e){return xc(t.databaseId,e.path)}function Pc(t,e){const n=Rc(e);if(n.get(1)!==t.databaseId.projectId)throw new Mr(Lr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Mr(Lr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Yr(Uc(n))}function Vc(t,e){return xc(t.databaseId,e)}function Fc(t){return new Wr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Uc(t){return kr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Bc(t,e,n){return{name:Oc(t,e),fields:n.value.mapValue.fields}}function jc(t,e){return{documents:[Vc(t,e.path)]}}function qc(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=Vc(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Vc(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Fo(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NAN"}};if(Vo(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Fo(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NOT_NAN"}};if(Vo(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gc(t.field),op:Hc(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Gc(t.field),direction:zc(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.gt||Co(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function $c(t){let e=function(t){const e=Rc(t);return 4===e.length?Wr.emptyPath():Uc(e)}(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){kr(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=Kc(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new oa(Wc(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Co(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ra(n,e)}(n.startAt));let h=null;return n.endAt&&(h=function(t){const e=!t.before,n=t.values||[];return new ra(n,e)}(n.endAt)),function(t,e,n,s,i,r,o,a){return new ua(t,e,n,s,i,r,o,a)}(e,i,o,r,a,"F",c,h)}function Kc(t){return t?void 0!==t.unaryFilter?[Xc(t)]:void 0!==t.fieldFilter?[Qc(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Kc(t))).reduce(((t,e)=>t.concat(e))):_r():[]}function zc(t){return Dc[t]}function Hc(t){return Ac[t]}function Gc(t){return{fieldPath:t.canonicalString()}}function Wc(t){return Xr.fromServerFormat(t.fieldPath)}function Qc(t){return Xo.create(Wc(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _r()}}(t.fieldFilter.op),t.fieldFilter.value)}function Xc(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Wc(t.unaryFilter.field);return Xo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Wc(t.unaryFilter.field);return Xo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Wc(t.unaryFilter.field);return Xo.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Wc(t.unaryFilter.field);return Xo.create(i,"!=",{nullValue:"NULL_VALUE"});default:return _r()}}function Yc(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Jc(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Zc{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&qa(s,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=$a(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=$a(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=uc();return this.mutations.forEach((s=>{const i=t.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=e.has(s.key)?null:o;const a=ja(r,o);null!==a&&n.set(s.key,a),r.isValidDocument()||r.convertToNoDocument(Hr.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),pc())}isEqual(t){return this.batchId===t.batchId&&Kr(this.mutations,t.mutations,((t,e)=>za(t,e)))&&Kr(this.baseMutations,t.baseMutations,((t,e)=>za(t,e)))}}class th{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){kr(t.mutations.length===n.length);let s=dc;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new th(t,e,n,s)}}class eh{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class nh{constructor(t,e,n,s,i=Hr.min(),r=Hr.min(),o=go.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new nh(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new nh(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new nh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class sh{constructor(t){this.re=t}}function ih(t){const e=$c({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?ga(e,e.limit,"L"):e}class rh{constructor(){}ce(t,e){this.ae(t,e),e.he()}ae(t,e){if("nullValue"in t)this.le(e,5);else if("booleanValue"in t)this.le(e,10),e.fe(t.booleanValue?1:0);else if("integerValue"in t)this.le(e,15),e.fe(vo(t.integerValue));else if("doubleValue"in t){const n=vo(t.doubleValue);isNaN(n)?this.le(e,13):(this.le(e,15),Do(n)?e.fe(0):e.fe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.le(e,20),"string"==typeof n?e.de(n):(e.de(`${n.seconds||""}`),e.fe(n.nanos||0))}else if("stringValue"in t)this._e(t.stringValue,e),this.we(e);else if("bytesValue"in t)this.le(e,30),e.me(wo(t.bytesValue)),this.we(e);else if("referenceValue"in t)this.ge(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.le(e,45),e.fe(n.latitude||0),e.fe(n.longitude||0)}else"mapValue"in t?jo(t)?this.le(e,Number.MAX_SAFE_INTEGER):(this.ye(t.mapValue,e),this.we(e)):"arrayValue"in t?(this.pe(t.arrayValue,e),this.we(e)):_r()}_e(t,e){this.le(e,25),this.Ie(t,e)}Ie(t,e){e.de(t)}ye(t,e){const n=t.fields||{};this.le(e,55);for(const t of Object.keys(n))this._e(t,e),this.ae(n[t],e)}pe(t,e){const n=t.values||[];this.le(e,50);for(const t of n)this.ae(t,e)}ge(t,e){this.le(e,37),Yr.fromName(t).path.forEach((t=>{this.le(e,60),this.Ie(t,e)}))}le(t,e){t.fe(e)}we(t){t.fe(2)}}rh.Te=new rh;class oh{constructor(){this.Ye=new ah}addToCollectionParentIndex(t,e){return this.Ye.add(e),no.resolve()}getCollectionParents(t,e){return no.resolve(this.Ye.getEntries(e))}addFieldIndex(t,e){return no.resolve()}deleteFieldIndex(t,e){return no.resolve()}getDocumentsMatchingTarget(t,e){return no.resolve(null)}getIndexType(t,e){return no.resolve(0)}getFieldIndexes(t,e){return no.resolve([])}getNextCollectionGroupToUpdate(t){return no.resolve(null)}getMinOffset(t,e){return no.resolve(Zr.min())}getMinOffsetFromCollectionGroup(t,e){return no.resolve(Zr.min())}updateCollectionGroup(t,e,n){return no.resolve()}updateIndexEntries(t,e){return no.resolve()}}class ah{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new lo(Wr.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new lo(Wr.comparator)).toArray()}}new Uint8Array(0);class ch{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new ch(t,ch.DEFAULT_COLLECTION_PERCENTILE,ch.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ch.DEFAULT_COLLECTION_PERCENTILE=10,ch.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ch.DEFAULT=new ch(41943040,ch.DEFAULT_COLLECTION_PERCENTILE,ch.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ch.DISABLED=new ch(-1,0,0);class hh{constructor(t){this.bn=t}next(){return this.bn+=2,this.bn}static Pn(){return new hh(0)}static vn(){return new hh(-1)}}class uh{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class lh{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.getBaseDocument(t,e,n)))).next((t=>(null!==n&&$a(n.mutation,t,po.empty(),zr.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,pc()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=pc()){const s=hc();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((t=>{let e=ac();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=hc();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,pc())))}populateOverlays(t,e,n){const s=[];return n.forEach((t=>{e.has(t)||s.push(t)})),this.documentOverlayCache.getOverlays(t,s).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,s){let i=rc();const r=lc(),o=lc();return e.forEach(((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof Ga)?i=i.insert(e.key,e):void 0!==o&&(r.set(e.key,o.mutation.getFieldMask()),$a(o.mutation,e,o.mutation.getFieldMask(),zr.now()))})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new uh(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=lc();let s=new co(((t,e)=>t-e)),i=pc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||po.empty();o=i.applyToLocalView(r,o),n.set(t,o);const a=(s.get(i.batchId)||pc()).add(t);s=s.insert(i.batchId,a)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,c=s.value,h=uc();c.forEach((t=>{if(!i.has(t)){const s=ja(e.get(t),n.get(t));null!==s&&h.set(t,s),i=i.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,a,h))}return no.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return Yr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):no.resolve(hc());let o=-1,a=i;return r.next((e=>no.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?no.resolve():this.getBaseDocument(t,e,n).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,pc()))).next((t=>({batchId:o,changes:cc(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Yr(e)).next((t=>{let e=ac();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const s=e.collectionGroup;let i=ac();return this.indexManager.getCollectionParents(t,s).next((r=>no.forEach(r,(r=>{const o=function(t,e){return new ua(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n){let s;return this.remoteDocumentCache.getAllFromCollection(t,e.path,n).next((i=>(s=i,this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId)))).next((t=>{t.forEach(((t,e)=>{const n=e.getKey();null===s.get(n)&&(s=s.insert(n,Ko.newInvalidDocument(n)))}));let n=ac();return s.forEach(((s,i)=>{const r=t.get(s);void 0!==r&&$a(r.mutation,i,po.empty(),zr.now()),wa(e,i)&&(n=n.insert(s,i))})),n}))}getBaseDocument(t,e,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(t,e):no.resolve(Ko.newInvalidDocument(e))}}class dh{constructor(t){this.It=t,this.Zn=new Map,this.ts=new Map}getBundleMetadata(t,e){return no.resolve(this.Zn.get(e))}saveBundleMetadata(t,e){var n;return this.Zn.set(e.id,{id:(n=e).id,version:n.version,createTime:Mc(n.createTime)}),no.resolve()}getNamedQuery(t,e){return no.resolve(this.ts.get(e))}saveNamedQuery(t,e){return this.ts.set(e.name,function(t){return{name:t.name,query:ih(t.bundledQuery),readTime:Mc(t.readTime)}}(e)),no.resolve()}}class fh{constructor(){this.overlays=new co(Yr.comparator),this.es=new Map}getOverlay(t,e){return no.resolve(this.overlays.get(e))}getOverlays(t,e){const n=hc();return no.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.ue(t,e,s)})),no.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.es.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.es.delete(n)),no.resolve()}getOverlaysForCollection(t,e,n){const s=hc(),i=e.length+1,r=new Yr(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&t.largestBatchId>n&&s.set(t.getKey(),t)}return no.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new co(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=hc(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=hc(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=s)););return no.resolve(o)}ue(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.es.get(s.largestBatchId).delete(n.key);this.es.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new eh(e,n));let i=this.es.get(e);void 0===i&&(i=pc(),this.es.set(e,i)),this.es.set(e,i.add(n.key))}}class ph{constructor(){this.ns=new lo(gh.ss),this.rs=new lo(gh.os)}isEmpty(){return this.ns.isEmpty()}addReference(t,e){const n=new gh(t,e);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.cs(new gh(t,e))}hs(t,e){t.forEach((t=>this.removeReference(t,e)))}ls(t){const e=new Yr(new Wr([])),n=new gh(e,t),s=new gh(e,t+1),i=[];return this.rs.forEachInRange([n,s],(t=>{this.cs(t),i.push(t.key)})),i}fs(){this.ns.forEach((t=>this.cs(t)))}cs(t){this.ns=this.ns.delete(t),this.rs=this.rs.delete(t)}ds(t){const e=new Yr(new Wr([])),n=new gh(e,t),s=new gh(e,t+1);let i=pc();return this.rs.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new gh(t,0),n=this.ns.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class gh{constructor(t,e){this.key=t,this._s=e}static ss(t,e){return Yr.comparator(t.key,e.key)||$r(t._s,e._s)}static os(t,e){return $r(t._s,e._s)||Yr.comparator(t.key,e.key)}}class mh{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.ws=1,this.gs=new lo(gh.ss)}checkEmpty(t){return no.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Zc(i,e,n,s);this.mutationQueue.push(r);for(const e of s)this.gs=this.gs.add(new gh(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return no.resolve(r)}lookupMutationBatch(t,e){return no.resolve(this.ys(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.ps(n),i=s<0?0:s;return no.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return no.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(t){return no.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new gh(e,0),s=new gh(e,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,s],(t=>{const e=this.ys(t._s);i.push(e)})),no.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new lo($r);return e.forEach((t=>{const e=new gh(t,0),s=new gh(t,Number.POSITIVE_INFINITY);this.gs.forEachInRange([e,s],(t=>{n=n.add(t._s)}))})),no.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;Yr.isDocumentKey(i)||(i=i.child(""));const r=new gh(new Yr(i),0);let o=new lo($r);return this.gs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t._s)),!0)}),r),no.resolve(this.Is(o))}Is(t){const e=[];return t.forEach((t=>{const n=this.ys(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){kr(0===this.Ts(e.batchId,"removed")),this.mutationQueue.shift();let n=this.gs;return no.forEach(e.mutations,(s=>{const i=new gh(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.gs=n}))}An(t){}containsKey(t,e){const n=new gh(e,0),s=this.gs.firstAfterOrEqual(n);return no.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,no.resolve()}Ts(t,e){return this.ps(t)}ps(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}ys(t){const e=this.ps(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class yh{constructor(t){this.Es=t,this.docs=new co(Yr.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,r=this.Es(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return no.resolve(n?n.document.mutableCopy():Ko.newInvalidDocument(e))}getEntries(t,e){let n=rc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ko.newInvalidDocument(t))})),no.resolve(n)}getAllFromCollection(t,e,n){let s=rc();const i=new Yr(e.child("")),r=this.docs.getIteratorFrom(i);for(;r.hasNext();){const{key:t,value:{document:i}}=r.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||to(Jr(i),n)<=0||(s=s.insert(i.key,i.mutableCopy()))}return no.resolve(s)}getAllFromCollectionGroup(t,e,n,s){_r()}As(t,e){return no.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new vh(this)}getSize(t){return no.resolve(this.size)}}class vh extends class{constructor(){this.changes=new sc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ko.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?no.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}{constructor(t){super(),this.Yn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Yn.addEntry(t,s)):this.Yn.removeEntry(n)})),no.waitFor(e)}getFromCache(t,e){return this.Yn.getEntry(t,e)}getAllFromCache(t,e){return this.Yn.getEntries(t,e)}}class wh{constructor(t){this.persistence=t,this.Rs=new sc((t=>Go(t)),Wo),this.lastRemoteSnapshotVersion=Hr.min(),this.highestTargetId=0,this.bs=0,this.Ps=new ph,this.targetCount=0,this.vs=hh.Pn()}forEachTarget(t,e){return this.Rs.forEach(((t,n)=>e(n))),no.resolve()}getLastRemoteSnapshotVersion(t){return no.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return no.resolve(this.bs)}allocateTargetId(t){return this.highestTargetId=this.vs.next(),no.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.bs&&(this.bs=e),no.resolve()}Dn(t){this.Rs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.vs=new hh(e),this.highestTargetId=e),t.sequenceNumber>this.bs&&(this.bs=t.sequenceNumber)}addTargetData(t,e){return this.Dn(e),this.targetCount+=1,no.resolve()}updateTargetData(t,e){return this.Dn(e),no.resolve()}removeTargetData(t,e){return this.Rs.delete(e.target),this.Ps.ls(e.targetId),this.targetCount-=1,no.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Rs.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Rs.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),no.waitFor(i).next((()=>s))}getTargetCount(t){return no.resolve(this.targetCount)}getTargetData(t,e){const n=this.Rs.get(e)||null;return no.resolve(n)}addMatchingKeys(t,e,n){return this.Ps.us(e,n),no.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),no.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Ps.ls(e),no.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Ps.ds(e);return no.resolve(n)}containsKey(t,e){return no.resolve(this.Ps.containsKey(e))}}class bh{constructor(t,e){this.Vs={},this.overlays={},this.Ss=new io(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=t(this),this.Cs=new wh(this),this.indexManager=new oh,this.remoteDocumentCache=function(t){return new yh(t)}((t=>this.referenceDelegate.xs(t))),this.It=new sh(e),this.Ns=new dh(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new fh,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Vs[t.toKey()];return n||(n=new mh(e,this.referenceDelegate),this.Vs[t.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(t,e,n){Sr("MemoryPersistence","Starting transaction:",t);const s=new Eh(this.Ss.next());return this.referenceDelegate.ks(),n(s).next((t=>this.referenceDelegate.Ms(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Os(t,e){return no.or(Object.values(this.Vs).map((n=>()=>n.containsKey(t,e))))}}class Eh extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}{constructor(t){super(),this.currentSequenceNumber=t}}class Ih{constructor(t){this.persistence=t,this.Fs=new ph,this.$s=null}static Bs(t){return new Ih(t)}get Ls(){if(this.$s)return this.$s;throw _r()}addReference(t,e,n){return this.Fs.addReference(n,e),this.Ls.delete(n.toString()),no.resolve()}removeReference(t,e,n){return this.Fs.removeReference(n,e),this.Ls.add(n.toString()),no.resolve()}markPotentiallyOrphaned(t,e){return this.Ls.add(e.toString()),no.resolve()}removeTarget(t,e){this.Fs.ls(e.targetId).forEach((t=>this.Ls.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ls.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}ks(){this.$s=new Set}Ms(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return no.forEach(this.Ls,(n=>{const s=Yr.fromPath(n);return this.Us(t,s).next((t=>{t||e.removeEntry(s,Hr.min())}))})).next((()=>(this.$s=null,e.apply(t))))}updateLimboDocument(t,e){return this.Us(t,e).next((t=>{t?this.Ls.delete(e.toString()):this.Ls.add(e.toString())}))}xs(t){return 0}Us(t,e){return no.or([()=>no.resolve(this.Fs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Os(t,e)])}}class Th{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Si=n,this.Di=s}static Ci(t,e){let n=pc(),s=pc();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Th(t,e.fromCache,n,s)}}class Sh{constructor(){this.xi=!1}initialize(t,e){this.Ni=t,this.indexManager=e,this.xi=!0}getDocumentsMatchingQuery(t,e,n,s){return this.ki(t,e).next((i=>i||this.Mi(t,e,s,n))).next((n=>n||this.Oi(t,e)))}ki(t,e){if(da(e))return no.resolve(null);let n=pa(e);return this.indexManager.getIndexType(t,n).next((s=>0===s?null:(null!==e.limit&&1===s&&(e=ga(e,null,"F"),n=pa(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((s=>{const i=pc(...s);return this.Ni.getDocuments(t,i).next((s=>this.indexManager.getMinOffset(t,n).next((n=>{const r=this.Fi(e,s);return this.$i(e,r,i,n.readTime)?this.ki(t,ga(e,null,"F")):this.Bi(t,r,e,n)}))))})))))}Mi(t,e,n,s){return da(e)||s.isEqual(Hr.min())?this.Oi(t,e):this.Ni.getDocuments(t,n).next((i=>{const r=this.Fi(e,i);return this.$i(e,r,n,s)?this.Oi(t,e):(Tr()<=w.DEBUG&&Sr("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),va(e)),this.Bi(t,r,e,function(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=Hr.fromTimestamp(1e9===s?new zr(n+1,0):new zr(n,s));return new Zr(i,Yr.empty(),e)}(s,-1)))}))}Fi(t,e){let n=new lo(ba(t));return e.forEach(((e,s)=>{wa(t,s)&&(n=n.add(s))})),n}$i(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Oi(t,e){return Tr()<=w.DEBUG&&Sr("QueryEngine","Using full collection scan to execute query:",va(e)),this.Ni.getDocumentsMatchingQuery(t,e,Zr.min())}Bi(t,e,n,s){return this.Ni.getDocumentsMatchingQuery(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Ch{constructor(t,e,n,s){this.persistence=t,this.Li=e,this.It=s,this.Ui=new co($r),this.qi=new sc((t=>Go(t)),Wo),this.Ki=new Map,this.Gi=t.getRemoteDocumentCache(),this.Cs=t.getTargetCache(),this.Ns=t.getBundleCache(),this.Qi(n)}Qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new lh(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ui)))}}async function Dh(t,e){const n=Nr(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next((i=>(s=i,n.Qi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],r=[];let o=pc();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({ji:t,removedBatchIds:i,addedBatchIds:r})))}))}))}function Ah(t){const e=Nr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Cs.getLastRemoteSnapshotVersion(t)))}function _h(t,e){const n=Nr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function kh(t,e,n){const s=Nr(t),i=s.Ui.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!so(t))throw t;Sr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ui=s.Ui.remove(e),s.qi.delete(i.target)}function Nh(t,e,n){const s=Nr(t);let i=Hr.min(),r=pc();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=Nr(t),i=s.qi.get(n);return void 0!==i?no.resolve(s.Ui.get(i)):s.Cs.getTargetData(e,n)}(s,t,pa(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Cs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.Li.getDocumentsMatchingQuery(t,e,n?i:Hr.min(),n?r:pc()))).next((t=>(function(t,e,n){let s=Hr.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.Ki.set(e,s)}(s,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,Hi:r})))))}class Lh{constructor(){this.activeTargetIds=mc()}er(t){this.activeTargetIds=this.activeTargetIds.add(t)}nr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}tr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Mh{constructor(){this.Lr=new Lh,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Lr.er(t),this.Ur[t]||"not-current"}updateQueryState(t,e,n){this.Ur[t]=e}removeLocalQueryTarget(t){this.Lr.nr(t)}isLocalQueryTarget(t){return this.Lr.activeTargetIds.has(t)}clearQueryState(t){delete this.Ur[t]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(t){return this.Lr.activeTargetIds.has(t)}start(){return this.Lr=new Lh,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class xh{qr(t){}shutdown(){}}class Rh{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(t){this.Wr.push(t)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){Sr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Wr)t(0)}jr(){Sr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Wr)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Oh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Ph{constructor(t){this.Hr=t.Hr,this.Jr=t.Jr}Yr(t){this.Xr=t}Zr(t){this.eo=t}onMessage(t){this.no=t}close(){this.Jr()}send(t){this.Hr(t)}so(){this.Xr()}io(t){this.eo(t)}ro(t){this.no(t)}}class Vh extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.oo=e+"://"+t.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}co(t,e,n,s,i){const r=this.ao(t,e);Sr("RestConnection","Sending: ",r,n);const o={};return this.ho(o,s,i),this.lo(t,r,o,n).then((t=>(Sr("RestConnection","Received: ",t),t)),(e=>{throw Dr("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}fo(t,e,n,s,i,r){return this.co(t,e,n,s,i)}ho(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Er,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}ao(t,e){const n=Oh[t];return`${this.oo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}lo(t,e,n,s){return new Promise(((i,r)=>{const o=new vr;o.listenOnce(fr.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case dr.NO_ERROR:const e=o.getResponseJson();Sr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case dr.TIMEOUT:Sr("Connection",'RPC "'+t+'" timed out'),r(new Mr(Lr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:const n=o.getStatus();if(Sr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Lr).indexOf(e)>=0?e:Lr.UNKNOWN}(t.status);r(new Mr(e,t.message))}else r(new Mr(Lr.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Mr(Lr.UNAVAILABLE,"Connection failed."));break;default:_r()}}finally{Sr("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(s);o.send(e,"POST",a,n,15)}))}_o(t,e,n){const s=[this.oo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=ur(),r=lr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new mr({})),this.ho(o.initMessageHeaders,e,n),o.encodeInitMessageHeaders=!0;const a=s.join("");Sr("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let h=!1,u=!1;const l=new Ph({Hr:t=>{u?Sr("Connection","Not sending because WebChannel is closed:",t):(h||(Sr("Connection","Opening WebChannel transport."),c.open(),h=!0),Sr("Connection","WebChannel sending:",t),c.send(t))},Jr:()=>c.close()}),d=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return d(c,yr.EventType.OPEN,(()=>{u||Sr("Connection","WebChannel transport opened.")})),d(c,yr.EventType.CLOSE,(()=>{u||(u=!0,Sr("Connection","WebChannel transport closed"),l.io())})),d(c,yr.EventType.ERROR,(t=>{u||(u=!0,Dr("Connection","WebChannel transport errored:",t),l.io(new Mr(Lr.UNAVAILABLE,"The operation could not be completed")))})),d(c,yr.EventType.MESSAGE,(t=>{var e;if(!u){const n=t.data[0];kr(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){Sr("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=tc[t];if(void 0!==e)return nc(e)}(t),n=i.message;void 0===e&&(e=Lr.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),u=!0,l.io(new Mr(e,n)),c.close()}else Sr("Connection","WebChannel received:",n),l.ro(n)}})),d(r,pr.STAT_EVENT,(t=>{t.stat===gr.PROXY?Sr("Connection","Detected buffering proxy"):t.stat===gr.NOPROXY&&Sr("Connection","Detected no buffering proxy")})),setTimeout((()=>{l.so()}),0),l}}function Fh(){return"undefined"!=typeof document?document:null}function Uh(t){return new _c(t,!0)}class Bh{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Hs=t,this.timerId=e,this.wo=n,this.mo=s,this.yo=i,this.po=0,this.Io=null,this.To=Date.now(),this.reset()}reset(){this.po=0}Eo(){this.po=this.yo}Ao(t){this.cancel();const e=Math.floor(this.po+this.Ro()),n=Math.max(0,Date.now()-this.To),s=Math.max(0,e-n);s>0&&Sr("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.po} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Io=this.Hs.enqueueAfterDelay(this.timerId,s,(()=>(this.To=Date.now(),t()))),this.po*=this.mo,this.po<this.wo&&(this.po=this.wo),this.po>this.yo&&(this.po=this.yo)}bo(){null!==this.Io&&(this.Io.skipDelay(),this.Io=null)}cancel(){null!==this.Io&&(this.Io.cancel(),this.Io=null)}Ro(){return(Math.random()-.5)*this.po}}class jh{constructor(t,e,n,s,i,r,o,a){this.Hs=t,this.Po=n,this.vo=s,this.Vo=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Bh(t,e)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Mo()}async stop(){this.No()&&await this.close(0)}Oo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.Po,6e4,(()=>this.$o())))}Bo(t){this.Lo(),this.stream.send(t)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(t,e){this.Lo(),this.Uo(),this.xo.cancel(),this.So++,4!==t?this.xo.reset():e&&e.code===Lr.RESOURCE_EXHAUSTED?(Cr(e.toString()),Cr("Using maximum backoff delay to prevent overloading the backend."),this.xo.Eo()):e&&e.code===Lr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Zr(e)}qo(){}auth(){this.state=1;const t=this.Ko(this.So),e=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.So===e&&this.Go(t,n)}),(e=>{t((()=>{const t=new Mr(Lr.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Qo(t)}))}))}Go(t,e){const n=this.Ko(this.So);this.stream=this.jo(t,e),this.stream.Yr((()=>{n((()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.vo,1e4,(()=>(this.ko()&&(this.state=3),Promise.resolve()))),this.listener.Yr())))})),this.stream.Zr((t=>{n((()=>this.Qo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Mo(){this.state=5,this.xo.Ao((async()=>{this.state=0,this.start()}))}Qo(t){return Sr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Ko(t){return e=>{this.Hs.enqueueAndForget((()=>this.So===t?e():(Sr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class qh extends jh{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.It=i}jo(t,e){return this.Vo._o("Listen",t,e)}onMessage(t){this.xo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_r()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.gt?(kr(void 0===e||"string"==typeof e),go.fromBase64String(e||"")):(kr(void 0===e||e instanceof Uint8Array),go.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Lr.UNKNOWN:nc(t.code);return new Mr(e,t.message||"")}(o);n=new Ec(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Pc(t,s.document.name),r=Mc(s.document.updateTime),o=new qo({mapValue:{fields:s.document.fields}}),a=Ko.newFoundDocument(i,r,o),c=s.targetIds||[],h=s.removedTargetIds||[];n=new wc(c,h,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Pc(t,s.document),r=s.readTime?Mc(s.readTime):Hr.min(),o=Ko.newNoDocument(i,r),a=s.removedTargetIds||[];n=new wc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Pc(t,s.document),r=s.removedTargetIds||[];n=new wc([],r,i,null)}else{if(!("filter"in e))return _r();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new Za(s),r=t.targetId;n=new bc(r,i)}}return n}(this.It,t),n=function(t){if(!("targetChange"in t))return Hr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Hr.min():e.readTime?Mc(e.readTime):Hr.min()}(t);return this.listener.Wo(e,n)}zo(t){const e={};e.database=Fc(this.It),e.addTarget=function(t,e){let n;const s=e.target;return n=Qo(s)?{documents:jc(t,s)}:{query:qc(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Nc(t,e.resumeToken):e.snapshotVersion.compareTo(Hr.min())>0&&(n.readTime=kc(t,e.snapshotVersion.toTimestamp())),n}(this.It,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _r()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.It,t);n&&(e.labels=n),this.Bo(e)}Ho(t){const e={};e.database=Fc(this.It),e.removeTarget=t,this.Bo(e)}}class $h extends jh{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.It=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Jo&&this.Xo([])}jo(t,e){return this.Vo._o("Write",t,e)}onMessage(t){if(kr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Jo){this.xo.reset();const e=function(t,e){return t&&t.length>0?(kr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Mc(t.updateTime):Mc(e);return n.isEqual(Hr.min())&&(n=Mc(e)),new Va(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Mc(t.commitTime);return this.listener.Zo(n,e)}return kr(!t.writeResults||0===t.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const t={};t.database=Fc(this.It),this.Bo(t)}Xo(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof Ha)n={update:Bc(t,e.key,e.value)};else if(e instanceof Ya)n={delete:Oc(t,e.key)};else if(e instanceof Ga)n={update:Bc(t,e.key,e.data),updateMask:Yc(e.fieldMask)};else{if(!(e instanceof Ja))return _r();n={verify:Oc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof ka)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Na)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ma)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ra)return{fieldPath:e.field.canonicalString(),increment:n.yt};throw _r()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Lc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_r()}(t,e.precondition)),n}(this.It,t)))};this.Bo(e)}}class Kh extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.Vo=n,this.It=s,this.nu=!1}su(){if(this.nu)throw new Mr(Lr.FAILED_PRECONDITION,"The client has already been terminated.")}co(t,e,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.Vo.co(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Lr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Mr(Lr.UNKNOWN,t.toString())}))}fo(t,e,n,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.Vo.fo(t,e,n,i,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Lr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Mr(Lr.UNKNOWN,t.toString())}))}terminate(){this.nu=!0}}class zh{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}hu(t){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.cu("Offline")))}set(t){this.lu(),this.iu=0,"Online"===t&&(this.ou=!1),this.cu(t)}cu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}au(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(Cr(e),this.ou=!1):Sr("OnlineStateTracker",e)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class Hh{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.qr((t=>{n.enqueueAndForget((async()=>{eu(this)&&(Sr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Nr(t);e._u.add(4),await Wh(e),e.gu.set("Unknown"),e._u.delete(4),await Gh(e)}(this))}))})),this.gu=new zh(n,s)}}async function Gh(t){if(eu(t))for(const e of t.wu)await e(!0)}async function Wh(t){for(const e of t.wu)await e(!1)}function Qh(t,e){const n=Nr(t);n.du.has(e.targetId)||(n.du.set(e.targetId,e),tu(n)?Zh(n):vu(n).ko()&&Yh(n,e))}function Xh(t,e){const n=Nr(t),s=vu(n);n.du.delete(e),s.ko()&&Jh(n,e),0===n.du.size&&(s.ko()?s.Fo():eu(n)&&n.gu.set("Unknown"))}function Yh(t,e){t.yu.Ot(e.targetId),vu(t).zo(e)}function Jh(t,e){t.yu.Ot(e),vu(t).Ho(e)}function Zh(t){t.yu=new Tc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),se:e=>t.du.get(e)||null}),vu(t).start(),t.gu.uu()}function tu(t){return eu(t)&&!vu(t).No()&&t.du.size>0}function eu(t){return 0===Nr(t)._u.size}function nu(t){t.yu=void 0}async function su(t){t.du.forEach(((e,n)=>{Yh(t,e)}))}async function iu(t,e){nu(t),tu(t)?(t.gu.hu(e),Zh(t)):t.gu.set("Unknown")}async function ru(t,e,n){if(t.gu.set("Online"),e instanceof Ec&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.du.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.du.delete(s),t.yu.removeTarget(s))}(t,e)}catch(n){Sr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ou(t,n)}else if(e instanceof wc?t.yu.Gt(e):e instanceof bc?t.yu.Yt(e):t.yu.Wt(e),!n.isEqual(Hr.min()))try{const e=await Ah(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.yu.te(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.du.get(s);i&&t.du.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.du.get(e);if(!n)return;t.du.set(e,n.withResumeToken(go.EMPTY_BYTE_STRING,n.snapshotVersion)),Jh(t,e);const s=new nh(n.target,e,1,n.sequenceNumber);Yh(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Sr("RemoteStore","Failed to raise snapshot:",e),await ou(t,e)}}async function ou(t,e,n){if(!so(e))throw e;t._u.add(1),await Wh(t),t.gu.set("Offline"),n||(n=()=>Ah(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Sr("RemoteStore","Retrying IndexedDB access"),await n(),t._u.delete(1),await Gh(t)}))}function au(t,e){return e().catch((n=>ou(t,n,e)))}async function cu(t){const e=Nr(t),n=wu(e);let s=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;hu(e);)try{const t=await _h(e.localStore,s);if(null===t){0===e.fu.length&&n.Fo();break}s=t.batchId,uu(e,t)}catch(t){await ou(e,t)}lu(e)&&du(e)}function hu(t){return eu(t)&&t.fu.length<10}function uu(t,e){t.fu.push(e);const n=wu(t);n.ko()&&n.Yo&&n.Xo(e.mutations)}function lu(t){return eu(t)&&!wu(t).No()&&t.fu.length>0}function du(t){wu(t).start()}async function fu(t){wu(t).eu()}async function pu(t){const e=wu(t);for(const n of t.fu)e.Xo(n.mutations)}async function gu(t,e,n){const s=t.fu.shift(),i=th.from(s,e,n);await au(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await cu(t)}async function mu(t,e){e&&wu(t).Yo&&await async function(t,e){if(function(t){switch(t){default:return _r();case Lr.CANCELLED:case Lr.UNKNOWN:case Lr.DEADLINE_EXCEEDED:case Lr.RESOURCE_EXHAUSTED:case Lr.INTERNAL:case Lr.UNAVAILABLE:case Lr.UNAUTHENTICATED:return!1;case Lr.INVALID_ARGUMENT:case Lr.NOT_FOUND:case Lr.ALREADY_EXISTS:case Lr.PERMISSION_DENIED:case Lr.FAILED_PRECONDITION:case Lr.ABORTED:case Lr.OUT_OF_RANGE:case Lr.UNIMPLEMENTED:case Lr.DATA_LOSS:return!0}}(n=e.code)&&n!==Lr.ABORTED){const n=t.fu.shift();wu(t).Oo(),await au(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await cu(t)}var n}(t,e),lu(t)&&du(t)}async function yu(t,e){const n=Nr(t);n.asyncQueue.verifyOperationInProgress(),Sr("RemoteStore","RemoteStore received new credentials");const s=eu(n);n._u.add(3),await Wh(n),s&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n._u.delete(3),await Gh(n)}function vu(t){return t.pu||(t.pu=function(t,e,n){const s=Nr(t);return s.su(),new qh(e,s.Vo,s.authCredentials,s.appCheckCredentials,s.It,n)}(t.datastore,t.asyncQueue,{Yr:su.bind(null,t),Zr:iu.bind(null,t),Wo:ru.bind(null,t)}),t.wu.push((async e=>{e?(t.pu.Oo(),tu(t)?Zh(t):t.gu.set("Unknown")):(await t.pu.stop(),nu(t))}))),t.pu}function wu(t){return t.Iu||(t.Iu=function(t,e,n){const s=Nr(t);return s.su(),new $h(e,s.Vo,s.authCredentials,s.appCheckCredentials,s.It,n)}(t.datastore,t.asyncQueue,{Yr:fu.bind(null,t),Zr:mu.bind(null,t),tu:pu.bind(null,t),Zo:gu.bind(null,t)}),t.wu.push((async e=>{e?(t.Iu.Oo(),await cu(t)):(await t.Iu.stop(),t.fu.length>0&&(Sr("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))}))),t.Iu}class bu{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new xr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new bu(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Mr(Lr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Eu(t,e){if(Cr("AsyncQueue",`${e}: ${t}`),so(t))return new Mr(Lr.UNAVAILABLE,`${e}: ${t}`);throw t}class Iu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||Yr.comparator(e.key,n.key):(t,e)=>Yr.comparator(t.key,e.key),this.keyedMap=ac(),this.sortedSet=new co(this.comparator)}static emptySet(t){return new Iu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Iu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Iu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Tu{constructor(){this.Tu=new co(Yr.comparator)}track(t){const e=t.doc.key,n=this.Tu.get(e);n?0!==t.type&&3===n.type?this.Tu=this.Tu.insert(e,t):3===t.type&&1!==n.type?this.Tu=this.Tu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Tu=this.Tu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Tu=this.Tu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Tu=this.Tu.remove(e):1===t.type&&2===n.type?this.Tu=this.Tu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Tu=this.Tu.insert(e,{type:2,doc:t.doc}):_r():this.Tu=this.Tu.insert(e,t)}Eu(){const t=[];return this.Tu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Su{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new Su(t,e,Iu.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ma(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Cu{constructor(){this.Au=void 0,this.listeners=[]}}class Du{constructor(){this.queries=new sc((t=>ya(t)),ma),this.onlineState="Unknown",this.Ru=new Set}}function Au(t,e){const n=Nr(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.Pu(t)&&(s=!0);i.Au=t}}s&&ku(n)}function _u(t,e,n){const s=Nr(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function ku(t){t.Ru.forEach((t=>{t.next()}))}class Nu{constructor(t,e,n){this.query=t,this.vu=e,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Su(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.Vu?this.Du(t)&&(this.vu.next(t),e=!0):this.Cu(t,this.onlineState)&&(this.xu(t),e=!0),this.Su=t,e}onError(t){this.vu.error(t)}bu(t){this.onlineState=t;let e=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,t)&&(this.xu(this.Su),e=!0),e}Cu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.Nu&&n||t.docs.isEmpty()&&"Offline"!==e)}Du(t){if(t.docChanges.length>0)return!0;const e=this.Su&&this.Su.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}xu(t){t=Su.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Vu=!0,this.vu.next(t)}}class Lu{constructor(t){this.key=t}}class Mu{constructor(t){this.key=t}}class xu{constructor(t,e){this.query=t,this.Lu=e,this.Uu=null,this.current=!1,this.qu=pc(),this.mutatedKeys=pc(),this.Ku=ba(t),this.Gu=new Iu(this.Ku)}get Qu(){return this.Lu}ju(t,e){const n=e?e.Wu:new Tu,s=e?e.Gu:this.Gu;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const h=s.get(t),u=wa(this.query,e)?e:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.zu(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Ku(u,a)>0||c&&this.Ku(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(r=r.add(u),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Gu:r,Wu:n,$i:o,mutatedKeys:i}}zu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.Gu;this.Gu=t.Gu,this.mutatedKeys=t.mutatedKeys;const i=t.Wu.Eu();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _r()}};return n(t)-n(e)}(t.type,e.type)||this.Ku(t.doc,e.doc))),this.Hu(n);const r=e?this.Ju():[],o=0===this.qu.size&&this.current?1:0,a=o!==this.Uu;return this.Uu=o,0!==i.length||a?{snapshot:new Su(this.query,t.Gu,s,i,t.mutatedKeys,0===o,a,!1),Yu:r}:{Yu:r}}bu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Gu:this.Gu,Wu:new Tu,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Yu:[]}}Xu(t){return!this.Lu.has(t)&&!!this.Gu.has(t)&&!this.Gu.get(t).hasLocalMutations}Hu(t){t&&(t.addedDocuments.forEach((t=>this.Lu=this.Lu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Lu=this.Lu.delete(t))),this.current=t.current)}Ju(){if(!this.current)return[];const t=this.qu;this.qu=pc(),this.Gu.forEach((t=>{this.Xu(t.key)&&(this.qu=this.qu.add(t.key))}));const e=[];return t.forEach((t=>{this.qu.has(t)||e.push(new Mu(t))})),this.qu.forEach((n=>{t.has(n)||e.push(new Lu(n))})),e}Zu(t){this.Lu=t.Hi,this.qu=pc();const e=this.ju(t.documents);return this.applyChanges(e,!0)}tc(){return Su.fromInitialDocuments(this.query,this.Gu,this.mutatedKeys,0===this.Uu)}}class Ru{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Ou{constructor(t){this.key=t,this.ec=!1}}class Pu{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.nc={},this.sc=new sc((t=>ya(t)),ma),this.ic=new Map,this.rc=new Set,this.oc=new co(Yr.comparator),this.uc=new Map,this.cc=new ph,this.ac={},this.hc=new Map,this.lc=hh.vn(),this.onlineState="Unknown",this.fc=void 0}get isPrimaryClient(){return!0===this.fc}}async function Vu(t,e){const n=function(t){const e=Nr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Uu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Zu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ju.bind(null,e),e.nc.Wo=Au.bind(null,e.eventManager),e.nc._c=_u.bind(null,e.eventManager),e}(t);let s,i;const r=n.sc.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.tc();else{const t=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Cs.getTargetData(t,e).next((i=>i?(s=i,no.resolve(s)):n.Cs.allocateTargetId(t).next((i=>(s=new nh(e,i,0,t.currentSequenceNumber),n.Cs.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.Ui.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(t.targetId,t),n.qi.set(e,t.targetId)),t}))}(n.localStore,pa(e));n.isPrimaryClient&&Qh(n.remoteStore,t);const r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await async function(t,e,n,s){t.dc=(e,n,s)=>async function(t,e,n,s){let i=e.view.ju(n);i.$i&&(i=await Nh(t.localStore,e.query,!1).then((({documents:t})=>e.view.ju(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return Wu(t,e.targetId,o.Yu),o.snapshot}(t,e,n,s);const i=await Nh(t.localStore,e,!0),r=new xu(e,i.Hi),o=r.ju(i.documents),a=vc.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState),c=r.applyChanges(o,t.isPrimaryClient,a);Wu(t,n,c.Yu);const h=new Ru(e,n,r);return t.sc.set(e,h),t.ic.has(n)?t.ic.get(n).push(e):t.ic.set(n,[e]),c.snapshot}(n,e,s,"current"===r)}return i}async function Fu(t,e){const n=Nr(t),s=n.sc.get(e),i=n.ic.get(s.targetId);if(i.length>1)return n.ic.set(s.targetId,i.filter((t=>!ma(t,e)))),void n.sc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await kh(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),Xh(n.remoteStore,s.targetId),Hu(n,s.targetId)})).catch(eo)):(Hu(n,s.targetId),await kh(n.localStore,s.targetId,!0))}async function Uu(t,e){const n=Nr(t);try{const t=await function(t,e){const n=Nr(t),s=e.snapshotVersion;let i=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.Ui;const o=[];e.targetChanges.forEach(((r,a)=>{const c=i.get(a);if(!c)return;o.push(n.Cs.removeMatchingKeys(t,r.removedDocuments,a).next((()=>n.Cs.addMatchingKeys(t,r.addedDocuments,a))));let h=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?h=h.withResumeToken(go.EMPTY_BYTE_STRING,Hr.min()).withLastLimboFreeSnapshotVersion(Hr.min()):r.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(r.resumeToken,s)),i=i.insert(a,h),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,h,r)&&o.push(n.Cs.updateTargetData(t,h))}));let a=rc(),c=pc();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(function(t,e,n){let s=pc(),i=pc();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=rc();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(Hr.min())?(e.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),s=s.insert(n,r)):Sr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{Wi:s,zi:i}}))}(t,r,e.documentUpdates).next((t=>{a=t.Wi,c=t.zi}))),!s.isEqual(Hr.min())){const e=n.Cs.getLastRemoteSnapshotVersion(t).next((e=>n.Cs.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return no.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ui=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.uc.get(e);s&&(kr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.ec=!0:t.modifiedDocuments.size>0?kr(s.ec):t.removedDocuments.size>0&&(kr(s.ec),s.ec=!1))})),await Yu(n,t,e)}catch(t){await eo(t)}}function Bu(t,e,n){const s=Nr(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.sc.forEach(((n,s)=>{const i=s.view.bu(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Nr(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.bu(e)&&(s=!0)})),s&&ku(n)}(s.eventManager,e),t.length&&s.nc.Wo(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function ju(t,e,n){const s=Nr(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.uc.get(e),r=i&&i.key;if(r){let t=new co(Yr.comparator);t=t.insert(r,Ko.newNoDocument(r,Hr.min()));const n=pc().add(r),i=new yc(Hr.min(),new Map,new lo($r),t,n);await Uu(s,i),s.oc=s.oc.remove(r),s.uc.delete(e),Xu(s)}else await kh(s.localStore,e,!1).then((()=>Hu(s,e,n))).catch(eo)}async function qu(t,e){const n=Nr(t),s=e.batch.batchId;try{const t=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.Gi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=no.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);kr(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=pc();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(n.localStore,e);zu(n,s,null),Ku(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Yu(n,t)}catch(t){await eo(t)}}async function $u(t,e,n){const s=Nr(t);try{const t=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(kr(null!==e),s=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,s))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(s.localStore,e);zu(s,e,n),Ku(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Yu(s,t)}catch(n){await eo(n)}}function Ku(t,e){(t.hc.get(e)||[]).forEach((t=>{t.resolve()})),t.hc.delete(e)}function zu(t,e,n){const s=Nr(t);let i=s.ac[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.ac[s.currentUser.toKey()]=i}}function Hu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.ic.get(e))t.sc.delete(s),n&&t.nc._c(s,n);t.ic.delete(e),t.isPrimaryClient&&t.cc.ls(e).forEach((e=>{t.cc.containsKey(e)||Gu(t,e)}))}function Gu(t,e){t.rc.delete(e.path.canonicalString());const n=t.oc.get(e);null!==n&&(Xh(t.remoteStore,n),t.oc=t.oc.remove(e),t.uc.delete(n),Xu(t))}function Wu(t,e,n){for(const s of n)s instanceof Lu?(t.cc.addReference(s.key,e),Qu(t,s)):s instanceof Mu?(Sr("SyncEngine","Document no longer in limbo: "+s.key),t.cc.removeReference(s.key,e),t.cc.containsKey(s.key)||Gu(t,s.key)):_r()}function Qu(t,e){const n=e.key,s=n.path.canonicalString();t.oc.get(n)||t.rc.has(s)||(Sr("SyncEngine","New document in limbo: "+n),t.rc.add(s),Xu(t))}function Xu(t){for(;t.rc.size>0&&t.oc.size<t.maxConcurrentLimboResolutions;){const e=t.rc.values().next().value;t.rc.delete(e);const n=new Yr(Wr.fromString(e)),s=t.lc.next();t.uc.set(s,new Ou(n)),t.oc=t.oc.insert(n,s),Qh(t.remoteStore,new nh(pa(la(n.path)),s,2,io.at))}}async function Yu(t,e,n){const s=Nr(t),i=[],r=[],o=[];s.sc.isEmpty()||(s.sc.forEach(((t,a)=>{o.push(s.dc(a,e,n).then((t=>{if(t){s.isPrimaryClient&&s.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Th.Ci(a.targetId,t);r.push(e)}})))})),await Promise.all(o),s.nc.Wo(i),await async function(t,e){const n=Nr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>no.forEach(e,(e=>no.forEach(e.Si,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>no.forEach(e.Di,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!so(t))throw t;Sr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ui.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.Ui=n.Ui.insert(e,i)}}}(s.localStore,r))}async function Ju(t,e){const n=Nr(t);if(!n.currentUser.isEqual(e)){Sr("SyncEngine","User change. New user:",e.toKey());const t=await Dh(n.localStore,e);n.currentUser=e,function(t,e){t.hc.forEach((t=>{t.forEach((t=>{t.reject(new Mr(Lr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.hc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Yu(n,t.ji)}}function Zu(t,e){const n=Nr(t),s=n.uc.get(e);if(s&&s.ec)return pc().add(s.key);{let t=pc();const s=n.ic.get(e);if(!s)return t;for(const e of s){const s=n.sc.get(e);t=t.unionWith(s.view.Qu)}return t}}function tl(t){const e=Nr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=qu.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$u.bind(null,e),e}class el{constructor(){this.synchronizeTabs=!1}async initialize(t){this.It=Uh(t.databaseInfo.databaseId),this.sharedClientState=this.mc(t),this.persistence=this.gc(t),await this.persistence.start(),this.localStore=this.yc(t),this.gcScheduler=this.Ic(t,this.localStore),this.indexBackfillerScheduler=this.Tc(t,this.localStore)}Ic(t,e){return null}Tc(t,e){return null}yc(t){return function(t,e,n,s){return new Ch(t,e,n,s)}(this.persistence,new Sh,t.initialUser,this.It)}gc(t){return new bh(Ih.Bs,this.It)}mc(t){return new Mh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class nl{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Bu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ju.bind(null,this.syncEngine),await async function(t,e){const n=Nr(t);e?(n._u.delete(2),await Gh(n)):e||(n._u.add(2),await Wh(n),n.gu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Du}createDatastore(t){const e=Uh(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new Vh(s));var s;return function(t,e,n,s){return new Kh(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>Bu(this.syncEngine,t,0),r=Rh.C()?new Rh:new xh,new Hh(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const a=new Pu(t,e,n,s,i,r);return o&&(a.fc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Nr(t);Sr("RemoteStore","RemoteStore shutting down."),e._u.add(5),await Wh(e),e.mu.shutdown(),e.gu.set("Unknown")}(this.remoteStore)}}class sl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ac(this.observer.next,t)}error(t){this.observer.error?this.Ac(this.observer.error,t):Cr("Uncaught Error in snapshot listener:",t)}Rc(){this.muted=!0}Ac(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class il{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=br.UNAUTHENTICATED,this.clientId=qr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Sr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Sr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Mr(Lr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new xr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Eu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function rl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){return t.offlineComponents||(Sr("FirestoreClient","Using default OfflineComponentProvider"),await async function(t,e){t.asyncQueue.verifyOperationInProgress(),Sr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await Dh(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}(t,new el)),t.offlineComponents}(t);Sr("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>yu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>yu(e.remoteStore,n))),t.onlineComponents=e}async function ol(t){return t.onlineComponents||(Sr("FirestoreClient","Using default OnlineComponentProvider"),await rl(t,new nl)),t.onlineComponents}async function al(t){const e=await ol(t),n=e.eventManager;return n.onListen=Vu.bind(null,e.syncEngine),n.onUnlisten=Fu.bind(null,e.syncEngine),n}function cl(t,e,n={}){const s=new xr;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new sl({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=Nr(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}(t,o))),n.fromCache&&"server"===s.source?i.reject(new Mr(Lr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Nu(n,r,{includeMetadataChanges:!0,Nu:!0});return async function(t,e){const n=Nr(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new Cu),i)try{r.Au=await n.onListen(s)}catch(t){const n=Eu(t,`Initialization of query '${va(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.bu(n.onlineState),r.Au&&e.Pu(r.Au)&&ku(n)}(t,o)}(await al(t),t.asyncQueue,e,n,s))),s.promise}const hl=new Map;function ul(t,e,n){if(!n)throw new Mr(Lr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ll(t){if(!Yr.isDocumentKey(t))throw new Mr(Lr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function dl(t){if(Yr.isDocumentKey(t))throw new Mr(Lr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function fl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":_r()}function pl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Mr(Lr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=fl(t);throw new Mr(Lr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class gl{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Mr(Lr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Mr(Lr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,s){if(!0===e&&!0===s)throw new Mr(Lr.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class ml{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Mr(Lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Mr(Lr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gl(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Or;switch(t.type){case"gapi":const e=t.client;return new Fr(e,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Mr(Lr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=hl.get(t);e&&(Sr("ComponentProvider","Removing Datastore"),hl.delete(t),e.terminate())}(this),Promise.resolve()}}class yl{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wl(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new yl(this.firestore,t,this._key)}}class vl{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new vl(this.firestore,t,this._query)}}class wl extends vl{constructor(t,e,n){super(t,e,la(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new yl(this.firestore,null,new Yr(t))}withConverter(t){return new wl(this.firestore,t,this._path)}}function bl(t,e,...n){if(t=f(t),ul("collection","path",e),t instanceof ml){const s=Wr.fromString(e,...n);return dl(s),new wl(t,null,s)}{if(!(t instanceof yl||t instanceof wl))throw new Mr(Lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Wr.fromString(e,...n));return dl(s),new wl(t.firestore,null,s)}}class El{constructor(){this.$c=Promise.resolve(),this.Bc=[],this.Lc=!1,this.Uc=[],this.qc=null,this.Kc=!1,this.Gc=!1,this.Qc=[],this.xo=new Bh(this,"async_queue_retry"),this.jc=()=>{const t=Fh();t&&Sr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.bo()};const t=Fh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.jc)}get isShuttingDown(){return this.Lc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Wc(),this.zc(t)}enterRestrictedMode(t){if(!this.Lc){this.Lc=!0,this.Gc=t||!1;const e=Fh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.jc)}}enqueue(t){if(this.Wc(),this.Lc)return new Promise((()=>{}));const e=new xr;return this.zc((()=>this.Lc&&this.Gc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Bc.push(t),this.Hc())))}async Hc(){if(0!==this.Bc.length){try{await this.Bc[0](),this.Bc.shift(),this.xo.reset()}catch(t){if(!so(t))throw t;Sr("AsyncQueue","Operation failed with retryable error: "+t)}this.Bc.length>0&&this.xo.Ao((()=>this.Hc()))}}zc(t){const e=this.$c.then((()=>(this.Kc=!0,t().catch((t=>{this.qc=t,this.Kc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Cr("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Kc=!1,t))))));return this.$c=e,e}enqueueAfterDelay(t,e,n){this.Wc(),this.Qc.indexOf(t)>-1&&(e=0);const s=bu.createAndSchedule(this,t,e,n,(t=>this.Jc(t)));return this.Uc.push(s),s}Wc(){this.qc&&_r()}verifyOperationInProgress(){}async Yc(){let t;do{t=this.$c,await t}while(t!==this.$c)}Xc(t){for(const e of this.Uc)if(e.timerId===t)return!0;return!1}Zc(t){return this.Yc().then((()=>{this.Uc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Uc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Yc()}))}ta(t){this.Qc.push(t)}Jc(t){const e=this.Uc.indexOf(t);this.Uc.splice(e,1)}}class Il extends ml{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new El,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Sl(this),this._firestoreClient.terminate()}}function Tl(t){return t._firestoreClient||Sl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Sl(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new To(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new il(t._authCredentials,t._appCheckCredentials,t._queue,s)}class Cl{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Mr(Lr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xr(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Dl{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Dl(go.fromBase64String(t))}catch(t){throw new Mr(Lr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Dl(go.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Al{constructor(t){this._methodName=t}}class _l{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Mr(Lr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Mr(Lr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return $r(this._lat,t._lat)||$r(this._long,t._long)}}const kl=/^__.*__$/;class Nl{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Ga(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ha(t,this.data,e,this.fieldTransforms)}}function Ll(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _r()}}class Ml{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.It=n,this.ignoreUndefinedProperties=s,void 0===i&&this.ea(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get na(){return this.settings.na}sa(t){return new Ml(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ia(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.sa({path:n,ra:!1});return s.oa(t),s}ua(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.sa({path:n,ra:!1});return s.ea(),s}ca(t){return this.sa({path:void 0,ra:!0})}aa(t){return $l(t,this.settings.methodName,this.settings.ha||!1,this.path,this.settings.la)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ea(){if(this.path)for(let t=0;t<this.path.length;t++)this.oa(this.path.get(t))}oa(t){if(0===t.length)throw this.aa("Document fields must not be empty");if(Ll(this.na)&&kl.test(t))throw this.aa('Document fields cannot begin and end with "__"')}}class xl{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.It=n||Uh(t)}fa(t,e,n,s=!1){return new Ml({na:t,methodName:e,la:n,path:Xr.emptyPath(),ra:!1,ha:s},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function Rl(t){const e=t._freezeSettings(),n=Uh(t._databaseId);return new xl(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Ol(t,e,n,s,i,r={}){const o=t.fa(r.merge||r.mergeFields?2:0,e,n,i);Ul("Data must be an object, but it was:",o,s);const a=Vl(s,o);let c,h;if(r.merge)c=new po(o.fieldMask),h=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=Bl(e,s,n);if(!o.contains(i))throw new Mr(Lr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Kl(t,i)||t.push(i)}c=new po(t),h=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,h=o.fieldTransforms;return new Nl(new qo(a),c,h)}function Pl(t,e){if(Fl(t=f(t)))return Ul("Unsupported field value:",e,t),Vl(t,e);if(t instanceof Al)return function(t,e){if(!Ll(e.na))throw e.aa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.aa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.ra&&4!==e.na)throw e.aa("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Pl(i,e.ca(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=f(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Sa(e.It,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=zr.fromDate(t);return{timestampValue:kc(e.It,n)}}if(t instanceof zr){const n=new zr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:kc(e.It,n)}}if(t instanceof _l)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Dl)return{bytesValue:Nc(e.It,t._byteString)};if(t instanceof yl){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.aa(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:xc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.aa(`Unsupported field value: ${fl(t)}`)}(t,e)}function Vl(t,e){const n={};return ao(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):oo(t,((t,s)=>{const i=Pl(s,e.ia(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Fl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof zr||t instanceof _l||t instanceof Dl||t instanceof yl||t instanceof Al)}function Ul(t,e,n){if(!Fl(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=fl(n);throw"an object"===s?e.aa(t+" a custom object"):e.aa(t+" "+s)}}function Bl(t,e,n){if((e=f(e))instanceof Cl)return e._internalPath;if("string"==typeof e)return ql(t,e);throw $l("Field path arguments must be of type string or ",t,!1,void 0,n)}const jl=new RegExp("[~\\*/\\[\\]]");function ql(t,e,n){if(e.search(jl)>=0)throw $l(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Cl(...e.split("."))._internalPath}catch(s){throw $l(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function $l(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new Mr(Lr.INVALID_ARGUMENT,a+t+c)}function Kl(t,e){return t.some((t=>t.isEqual(e)))}class zl{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Hl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Gl("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Hl extends zl{data(){return super.data()}}function Gl(t,e){return"string"==typeof e?ql(t,e):e instanceof Cl?e._internalPath:e._delegate._internalPath}class Wl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ql extends zl{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Xl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Gl("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Xl extends Ql{data(t={}){return super.data(t)}}class Yl{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Wl(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Xl(this._firestore,this._userDataWriter,n.key,n,new Wl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Mr(Lr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Xl(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Wl(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Xl(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Wl(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Jl(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Jl(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _r()}}class Zl extends class{convertValue(t,e="none"){switch(_o(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vo(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(wo(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw _r()}}convertObject(t,e){const n={};return oo(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new _l(vo(t.latitude),vo(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Eo(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Io(t));default:return null}}convertTimestamp(t){const e=yo(t);return new zr(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Wr.fromString(t);kr(Jc(n));const s=new So(n.get(1),n.get(3)),i=new Yr(n.popFirst(5));return s.isEqual(e)||Cr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new Dl(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new yl(this.firestore,null,e)}}function td(t,e){const n=pl(t.firestore,Il),s=function(t,e,...n){if(t=f(t),1===arguments.length&&(e=qr.R()),ul("doc","path",e),t instanceof ml){const s=Wr.fromString(e,...n);return ll(s),new yl(t,null,new Yr(s))}{if(!(t instanceof yl||t instanceof wl))throw new Mr(Lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Wr.fromString(e,...n));return ll(s),new yl(t.firestore,t instanceof wl?t.converter:null,new Yr(s))}}(t),i=function(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}(t.converter,e);return function(t,e){return function(t,e){const n=new xr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=tl(t);try{const t=await function(t,e){const n=Nr(t),s=zr.now(),i=e.reduce(((t,e)=>t.add(e.key)),pc());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=rc(),c=pc();return n.Gi.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{r=i;const o=[];for(const t of e){const e=Ka(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new Ga(t.key,e,$o(e.value.mapValue),Fa.exists(!0)))}return n.mutationQueue.addMutationBatch(t,s,o,e)})).next((e=>{o=e;const s=e.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:cc(r)})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.ac[t.currentUser.toKey()];s||(s=new co($r)),s=s.insert(e,n),t.ac[t.currentUser.toKey()]=s}(s,t.batchId,n),await Yu(s,t.changes),await cu(s.remoteStore)}catch(t){const e=Eu(t,"Failed to persist write");n.reject(e)}}(await function(t){return ol(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Tl(t),e)}(n,[Ol(Rl(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,Fa.exists(!1))]).then((()=>s))}!function(t,e=!0){Er="9.10.0",Y(new p("firestore",((t,{instanceIdentifier:n,options:s})=>{const i=t.getProvider("app").getImmediate(),r=new Il(new Pr(t.getProvider("auth-internal")),new Br(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Mr(Lr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new So(t.options.projectId,e)}(i,n),i);return s=Object.assign({useFetchStreams:e},s),r._setSettings(s),r}),"PUBLIC").setMultipleInstances(!0)),nt(wr,"3.5.0",t),nt(wr,"3.5.0","esm2017")}(),n(364);const ed=n(642),nd=n(938),sd=function(t,e={}){"object"!=typeof e&&(e={name:e});const n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},e),s=n.name;if("string"!=typeof s||!s)throw Z.create("bad-app-name",{appName:String(s)});const i=W.get(s);if(i){if(u(t,i.options)&&u(n,i.config))return i;throw Z.create("duplicate-app",{appName:s})}const r=new y(s);for(const t of Q.values())r.addComponent(t);const o=new tt(t,n,r);return W.set(s,o),o}({apiKey:"AIzaSyAxg8A0c7BS-2iACReC07XIrAh6cJm7tAA",authDomain:"snacke-7f207.firebaseapp.com",projectId:"snacke-7f207",storageBucket:"snacke-7f207.appspot.com",messagingSenderId:"4042206255",appId:"1:4042206255:web:180112e052b5d67d13aada",measurementId:"G-NW07VHLBPW"}),id=(function(t=et()){const e=J(t=f(t),Ht);e.isInitialized()?e.getImmediate():function(t,e={}){const n=J(t,Ht);if(n.isInitialized()){const t=n.getImmediate();if(u(e,n.getOptions()))return t;throw Xt.create("already-initialized")}n.initialize({options:e})}(t)}(sd),function(t,e){const n="string"==typeof t?t:"(default)";return J("object"==typeof t?t:et(),"firestore").getImmediate({identifier:n})}(sd)),rd=async function(t){await td(bl(id,"scores"),{data:t})},od=async function(){let t=bl(id,"scores");const e=await function(t){t=pl(t,vl);const e=pl(t.firestore,Il),n=Tl(e),s=new Zl(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Mr(Lr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),cl(n,t._query).then((n=>new Yl(e,s,t,n)))}(t);let n=[];return e.forEach((t=>{n.push(t.data())})),n};window.addEventListener("keydown",(t=>{["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.code)&&t.preventDefault()}),!1),document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("game-canvas");t.width=1e3,t.height=600;const e=t.getContext("2d"),n=document.getElementById("info-canvas");n.width=400,n.height=600;const s=n.getContext("2d");document.getElementById("bgm").volume=.2;let i=new ed(1e3,600);i.sendScore=rd,i.getScore=od;let r=new nd(i,e,s);i.makeHighScoreTable(),r.start()}))}()}();
//# sourceMappingURL=main.js.map